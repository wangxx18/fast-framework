var CarsView=function(){function e(a,b,c,d,f){if("string"!=typeof a||null==a||void 0==a||""==a)this.error=-1;else if("string"!=typeof b||null==b||void 0==b||""==b||"ssr"!=b&&"csr"!=b)this.error=-1;else if("string"!=typeof c||null==c||""==c||void 0==c)this.error=-1;else if("function"!=typeof d||void 0==d||null==d)this.error=-1;else{if("boolean"!=typeof f||void 0==f||null==f)this.isNeedRequestWithGuid=!1,this.setStreamingMode("all");1==this.isNeedRequestWithGuid?this.setStreamingMode("ondemand"):this.setStreamingMode("all");
this.modelBounding=this.guidsMap=this.nodeCount=this.modelName=this.carsTree=this.bar=this.cuttingPlaneController=this.hwv=this.rendererType=this.isProxy=this.containerId=this.memoryLimit=this.streamingMode=this.screenConfiguration=null;var g=this;this._annotationMap=new Map;return new Promise(function(f,e){g.init(a,b,c,d).then(function(){f(g)},function(){e()})})}}e.prototype.init=function(a,b,c,d){var f=this;f.containerId=a;return new Promise(function(g,l){var e=f.initCarsViewer(a),k=f.setRendererType(b);
0!=e||0!=k?l():f.openModel(c).then(function(a){window.onresize=function(b){"function"!==typeof b.target.getAttribute&&a.resizeCanvas()};f.hwv=a;document.getElementById(f.containerId);"function"!=typeof d&&l("callback\u53c2\u6570\u975efunction");a.start()||l("\u5f15\u64ce\u521d\u59cb\u5316\u5931\u8d25");new Communicator.Ui.Desktop.DesktopUi(a,Communicator.ScreenConfiguration.Desktop,f.containerId);f.hwv.setCallbacks({sceneReady:function(){f.setLogoVersionInfo();f.setBackgroundColor(255,255,255,30,
144,255)},modelStructureReady:function(){f.setBackgroundColor(255,255,255,30,144,255);f.hwv.getView().setBackfacesVisible(!0);f.setGuidMap();f.setNodeCount();g()},modelStructureLoadBegin:function(){f.setBackgroundColor(255,255,255,30,144,255)},streamingActivated:function(){f.setBackgroundColor(255,255,255,30,144,255)},selection:function(a){var b=a.getSelection();null!=b&&void 0!=b||d(b.getNodeId());var c=null;a=f.hwv.getModel().getNodeType(b.getNodeId());if(a==Communicator.NodeType.PMI||a==Communicator.NodeType.PMIBody||
1==b.overlayIndex()||Communicator.Markup.NoteText.checkForSelectedPin(f.hwv,b)||Communicator.Markup.NoteText.getExplodeActive()||Communicator.Markup.NoteText.getIsolateActive()||Communicator.Markup.ImgMarkup.checkForSelectedPin(f.hwv,b)||Communicator.Markup.ImgMarkup.getExplodeActive()||Communicator.Markup.ImgMarkup.getIsolateActive())d(b.getNodeId(),b.getPosition());else{a=f.hwv.getSelectionManager().getResults();for(var g=[],l=[],e=0;e<a.length;e++)b=a[e],c=b.getNodeId(),l.push(c),null==c?g.push(-1):
(c=f.getGuidFromNodeId(c),g.push(c));void 0==l||0>=l.length?d(g,b.getPosition(),{x:0,y:0,z:0},{x:1,y:0,z:0}):f.hwv.getModel().getNodesBounding(l).then(function(a){if(void 0!=a||null!=a)if(void 0==b.getFaceEntity()||void 0==b.getFaceEntity().getNormal())d(g,b.getPosition(),{x:a.center().x,y:a.center().y,z:a.center().z},{x:1,y:0,z:0});else{var c=b.getFaceEntity().getNormal();d(g,b.getPosition(),{x:a.center().x,y:a.center().y,z:a.center().z},{x:c.x,y:c.y,z:c.z})}})}}})},function(a){a=new Communicator.Ui.UiDialog(f.containerId);
a.setTitle("\u9519\u8bef\u9875\u9762");a.setText("\u521d\u59cb\u5316\u5931\u8d25");a.show();l("\u5f15\u64ce\u521d\u59cb\u5316\u5931\u8d25")})})};e.prototype.setLayout=function(a,b){return"object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv?-1:new Communicator.Ui.Desktop.DesktopUi(this.hwv,"mobile"==b?Communicator.ScreenConfiguration.Mobile:Communicator.ScreenConfiguration.Desktop,this.containerId)};e.prototype.setStreamingMode=function(a){if(null==a||"string"!=typeof a||""==a||"interactive"!=
a&&"all"!=a&&"ondemand"!=a)return-1;var b=null;switch(a.toLowerCase()){case "interactive":b=Communicator.StreamingMode.Interactive;break;case "all":b=Communicator.StreamingMode.All;break;case "ondemand":b=Communicator.StreamingMode.OnDemand}this.streamingMode=b;return 0};e.prototype.setMemoryLimit=function(a){if(null==a||"number"!=typeof a||!this.isPInt(a))return-1;this.memoryLimit=null==a?0:parseInt(a);return 0};e.prototype.urlReWrite=function(a){a=/([ws]+):\/\/(.*):([0-9]+)/.exec(a);var b=a[1];
return b+"://"+a[2]+"/"+b+"proxy/"+a[3]};e.prototype.initCarsViewer=function(a){if(null==a||""==a||"string"!=typeof a)return-1;document.getElementById(this.containerId).innerHTML="";a="<div id='"+this.containerId+"toolBar' style='position: absolute;display: none;user-select: none;z-index: 10000; -webkit-user-select: none;'><div class='toolbar-tools'><div id='"+this.containerId+"home-button' title='\u4e3b\u89c6\u56fe' data-operatorclass='toolbar-home' class='carsview-tool'><div class='tool-icon'></div></div><div id='tool_separator_1' class='tool-separator'></div><div id='"+
this.containerId+"view-button' title='\u89c6\u56fe\u83dc\u5355' data-operatorclass='toolbar-camera' data-submenu='"+this.containerId+"view-submenu' class='carsview-tool toolbar-menu'><div class='tool-icon'></div></div><div id='"+this.containerId+"edgeface-button' title='\u7ebf\u6846\u52a0\u5b9e\u4f53\u6a21\u5f0f' data-operatorclass='toolbar-wireframeshaded' data-submenu='"+this.containerId+"edgeface-submenu' class='carsview-tool toolbar-menu'><div class='tool-icon'></div></div><div id='tool_separator_2' class='tool-separator'></div><div id='"+
this.containerId+"redline-button' title='\u6279\u6ce8' data-operatorclass='toolbar-redline-note' data-submenu='"+this.containerId+"redline-submenu' class='carsview-tool toolbar-radio'><div class='smarrow'></div><div class='tool-icon'></div></div><div id='"+this.containerId+"click-button' title='\u9009\u62e9' data-operatorclass='toolbar-select' data-submenu='"+this.containerId+"click-submenu' class='carsview-tool toolbar-radio active-tool'><div class='smarrow'></div><div class='tool-icon'></div></div><div id='"+
this.containerId+"camera-button' title='\u65cb\u8f6c\u4e0e\u6f2b\u6e38' data-operatorclass='toolbar-orbit' data-submenu='"+this.containerId+"camera-submenu' class='carsview-tool toolbar-menu'><div class='tool-icon'></div></div><div id='tool_separator_3' class='tool-separator'></div><div id='"+this.containerId+"explode-button' title='\u7206\u70b8\u83dc\u5355' data-operatorclass='toolbar-explode' data-submenu='"+this.containerId+"explode-slider' class='carsview-tool toolbar-menu-toggle'><div class='tool-icon'></div></div><div id='"+
this.containerId+"cuttingplane-button' title='\u5228\u5207\u83dc\u5355' data-operatorclass='toolbar-cuttingplane' data-submenu='"+this.containerId+"cuttingplane-submenu' class='carsview-tool toolbar-menu-toggle'><div class='tool-icon'></div></div><div id='tool_separator_4' class='tool-separator'></div><div id='"+this.containerId+"snapshot-button' title='\u622a\u5c4f' data-operatorclass='toolbar-snapshot' class='carsview-tool'><div class='tool-icon'></div></div></div><div id='"+this.containerId+"submenus'><div id='"+
this.containerId+"redline-submenu' data-button='"+this.containerId+"redline-button' class='toolbar-submenu submenus'><table><tr><td><div id='"+this.containerId+"redline-circle-button' title='\u5706\u5f62\u6279\u6ce8' data-operatorclass='toolbar-redline-circle' class='submenu-icon'></div></td><td><div id='"+this.containerId+"redline-rectangle-button' title='\u77e9\u9635\u6279\u6ce8' data-operatorclass='toolbar-redline-rectangle' class='submenu-icon'></div></td></tr><tr><td><div id='"+this.containerId+
"redline-note' title='\u6587\u5b57\u6279\u6ce8' data-operatorclass='toolbar-redline-note' class='submenu-icon'></div></td><td><div id='"+this.containerId+"redline-freehand' title='\u81ea\u7531\u6279\u6ce8' data-operatorclass='toolbar-redline-freehand' class='submenu-icon'></div></td></tr></table></div><div id='"+this.containerId+"camera-submenu' data-button='"+this.containerId+"camera-button' class='toolbar-submenu submenus'><table><tr><td><div id='"+this.containerId+"operator-camera-walk' title='\u6f2b\u6e38' data-operatorclass='toolbar-walk' class='submenu-icon'></div></td></tr><tr><td><div id='"+
this.containerId+"operator-camera-turntable' title='\u5b9a\u8f74\u65cb\u8f6c' data-operatorclass='toolbar-turntable' class='submenu-icon'></div></td></tr><tr><td><div id='"+this.containerId+"operator-camera-orbit' title='\u65cb\u8f6c' data-operatorclass='toolbar-orbit' class='submenu-icon'></div></td></tr></table></div><div id='"+this.containerId+"edgeface-submenu' data-button='"+this.containerId+"edgeface-button' class='toolbar-submenu submenus'><table><tr><td><div id='"+this.containerId+"viewport-wireframe-on-shaded' title='\u5e26\u7ebf\u6e32\u67d3' data-operatorclass='toolbar-wireframeshaded' class='submenu-icon'></div></td></tr><tr><td><div id='"+
this.containerId+"viewport-shaded' title='\u4e0d\u5e26\u7ebf\u6e32\u67d3' data-operatorclass='toolbar-shaded' class='submenu-icon'></div></td></tr><tr><td><div id='"+this.containerId+"viewport-hidden-lines' title='\u9690\u7ebf' data-operatorclass='toolbar-hidden-line' class='submenu-icon'></div></td></tr><tr><td><div id='"+this.containerId+"viewport-wireframe' title='\u7ebf\u6846' data-operatorclass='toolbar-wireframe' class='submenu-icon'></div></td></tr></table></div><div id='"+this.containerId+
"view-submenu' data-button='"+this.containerId+"view-button' class='toolbar-submenu submenus'><table><tr><td><div id='"+this.containerId+"view-face' title='\u9009\u4e2d\u5c45\u4e2d' data-operatorclass='toolbar-face' class='submenu-icon disabled'></div></td></tr><tr><td><div id='"+this.containerId+"view-iso' title='\u6807\u51c6\u89c6\u56fe' data-operatorclass='toolbar-iso' class='submenu-icon'></div></td><td><div id='"+this.containerId+"view-ortho' title='\u76f4\u89d2\u89c6\u56fe' data-operatorclass='toolbar-ortho' class='submenu-icon'></div></td><td><div id='"+
this.containerId+"view-persp' title='\u900f\u89c6\u56fe' data-operatorclass='toolbar-persp' class='submenu-icon'></div></td></tr><tr><td><div id='"+this.containerId+"view-left' title='\u5de6\u89c6\u56fe' data-operatorclass='toolbar-left' class='submenu-icon'></div></td><td><div id='"+this.containerId+"view-right' title='\u53f3\u89c6\u56fe' data-operatorclass='toolbar-right' class='submenu-icon'></div></td><td><div id='"+this.containerId+"view-bottom' title='\u5e95\u89c6\u56fe' data-operatorclass='toolbar-bottom' class='submenu-icon'></div></td></tr><tr><td><div id='"+
this.containerId+"view-front' title='\u524d\u89c6\u56fe' data-operatorclass='toolbar-front' class='submenu-icon'></div></td><td><div id='"+this.containerId+"view-back' title='\u540e\u89c6\u56fe' data-operatorclass='toolbar-back' class='submenu-icon'></div></td><td><div id='"+this.containerId+"view-top' title='\u9876\u89c6\u56fe' data-operatorclass='toolbar-top' class='submenu-icon'></div></td></tr></table></div><div id='"+this.containerId+"click-submenu' data-button='"+this.containerId+"click-button' class='toolbar-submenu submenus'><table><tr><td><div id='"+
this.containerId+"note-button' title='\u521b\u5efa\u6807\u8bb0\u5927\u5934\u9488' data-operatorclass='toolbar-note' class='submenu-icon'></div></td></tr><tr><td><div id='"+this.containerId+"measure-angle-between-faces' title='\u6d4b\u91cf\u9762\u4e0e\u9762\u7684\u89d2\u5ea6' data-operatorclass='toolbar-measure-angle' class='submenu-icon'></div></td><td><div id='"+this.containerId+"measure-distance-between-faces' title='\u6d4b\u91cf\u9762\u4e0e\u9762\u7684\u8ddd\u79bb' data-operatorclass='toolbar-measure-distance' class='submenu-icon'></div></td></tr><tr><td><div id='"+
this.containerId+"measure-edges' title='\u6d4b\u91cf\u8fb9' data-operatorclass='toolbar-measure-edge' class='submenu-icon'></div></td><td><div id='"+this.containerId+"measure-point-to-point' title='\u6d4b\u91cf\u70b9\u5230\u70b9\u8ddd\u79bb' data-operatorclass='toolbar-measure-point' class='submenu-icon'></div></td></tr><tr><td><div id='"+this.containerId+"select-parts' title='\u70b9\u9009' data-operatorclass='toolbar-select' class='submenu-icon'></div></td><td><div id='"+this.containerId+"area-select' title='\u6846\u9009' data-operatorclass='toolbar-area-select' class='submenu-icon'></div></td></tr></table></div><div id='"+
this.containerId+"explode-slider' class='toolbar-submenu slider-menu submenus'><div id='"+this.containerId+"explosion-slider' style='height:90px;background: rgb(222,222,222);' class='toolbar-slider'></div></div><div id='"+this.containerId+"cuttingplane-submenu' data-button='"+this.containerId+"cuttingplane-button' class='toolbar-submenu cutting-plane submenus no-modal'><table><tr><td><div id='"+this.containerId+"cuttingplane-face' title='\u5728\u9009\u4e2d\u9762\u521b\u5efa\u5228\u5207\u9762\u677f' data-plane='face' data-operatorclass='toolbar-cuttingplane-face' class='toolbar-cp-plane submenu-icon disabled'></div></td></tr><tr><td><div id='"+
this.containerId+"cuttingplane-x' title='X\u8f74\u5228\u5207' data-plane='x' data-operatorclass='toolbar-cuttingplane-x' class='toolbar-cp-plane submenu-icon'></div></td><td><div id='"+this.containerId+"cuttingplane-section' title='\u5228\u5207\u9762\u677f\u53ef\u89c1\u6027\u5207\u6362' data-plane='section' data-operatorclass='toolbar-cuttingplane-section' class='toolbar-cp-plane submenu-icon disabled'></div></td></tr><tr><td><div id='"+this.containerId+"cuttingplane-y' title='Y\u8f74\u5228\u5207' data-plane='y' data-operatorclass='toolbar-cuttingplane-y' class='toolbar-cp-plane submenu-icon'></div></td><td><div id='"+
this.containerId+"cuttingplane-toggle' title='\u5228\u5207\u9762\u677f\u90e8\u5206\u5207\u6362' data-plane='toggle' data-operatorclass='toolbar-cuttingplane-toggle' class='toolbar-cp-plane submenu-icon disabled'></div></td></tr><tr><td><div id='"+this.containerId+"cuttingplane-z' title='Z\u8f74\u5228\u5207' data-plane='z' data-operatorclass='toolbar-cuttingplane-z' class='toolbar-cp-plane submenu-icon'></div></td><td><div id='"+this.containerId+"cuttingplane-reset' title='\u91cd\u7f6e\u5228\u5207\u9762\u677f' data-plane='reset' data-operatorclass='toolbar-cuttingplane-reset' class='toolbar-cp-plane submenu-icon disabled'></div></td></tr></table></div></div></div>";
var b="<div id='"+this.containerId+"viewer-settings-dialog' class='carsview-ui-window' style='display: none;z-index: 21000; background: white; border: 1px solid black; position: absolute; top: 0; left: 0; font-size: 13px;min-width: 500px;'><div class='carsview-ui-window-header'>  \u8bbe\u7f6e</div><div class='carsview-ui-window-body' style='height: 335px;overflow-y: scroll;padding-right: 10px;'><div class='settings-group-header'> \u5e38\u89c4</div><div class='settings-group settings-group-general'><div class='settings-block'><label> \u6295\u5c04\u6a21\u5f0f:</label><select id='"+
this.containerId+"settings-projection-mode' class='right-align'><option value='0'> \u6b63\u5c04\u6295\u5f71</option><option value='1'> \u900f\u89c6\u6295\u5f71</option></select><span class='clear-both'></span></div><div class='settings-block'><span class='framerate-text'> \u5e27\u901f\u7387 (fps):</span><input type='number' min='0' id='settings-framerate' class='right-align' /><span class='clear-both'></span></div><div class='settings-block'><span> \u9690\u7ebf\u7684\u4e0d\u900f\u660e\u5ea6 (0-1): </span><input id='"+
this.containerId+"settings-hidden-line-opacity' class='right-align' type='number' min='0' max='1' step='.1' /><span class='clear-both'></span></div><div class='settings-block'><label for='settings-show-backfaces'> \u80cc\u9762\u5254\u9664:</label><input type='checkbox' id='"+this.containerId+"settings-show-backfaces' class='right-align' /><span class='clear-both'></span></div><div class='settings-block'><label for='settings-show-capping-geometry'> \u663e\u793a\u51e0\u4f55\u8986\u76d6:</label><input type='checkbox' id='"+
this.containerId+"settings-show-capping-geometry' class='right-align' /><span class='clear-both'></span></div><div class='settings-block'><span> \u5141\u8bb8 \u9762/\u7ebf \u9009\u4e2d: </span><input type='checkbox' id='"+this.containerId+"settings-enable-face-line-selection' class='right-align' /><span class='clear-both'></span></div><div class='settings-block'><span> \u65cb\u8f6c\u955c\u5934\u4e2d\u5fc3:</span><input type='checkbox' id='"+this.containerId+"settings-orbit-mode' class='right-align' /><span class='clear-both'></span></div></div><div class='settings-group-header'> \u6548\u679c</div><div class='settings-group settings-group-general'><div class='settings-block'><span> \u542f\u7528\u73af\u5883\u5149\u906e\u853d\u6548\u679c:</span><input type='checkbox' id='"+
this.containerId+"settings-ambient-occlusion' /><input id='"+this.containerId+"settings-ambient-occlusion-radius' type='number' min='0' max='10' step='.01' class='right-align' /><div class='right-align'> \u534a\u5f84: </div><span class='clear-both'></span></div><div class='settings-block'><span> \u542f\u7528\u6297\u952f\u9f7f:</span><input type='checkbox' id='"+this.containerId+"settings-anti-aliasing' class='right-align' /><span class='clear-both'></span></div></div><div class='settings-group-header'>\u8f74\u7ebf</div><div class='settings-group settings-group-general'><div class='settings-block'><span> \u663e\u793a\u4e09\u91cd\u8f74:</span><input type='checkbox' id='"+
this.containerId+"settings-axis-triad' class='right-align' /><span class='clear-both'></span></div><div class='settings-block'><span> \u663e\u793a\u89c6\u56fe\u5bfc\u822a\u65b9\u4f53:</span><input type='checkbox' id='"+this.containerId+"settings-nav-cube' class='right-align' /><span class='clear-both'></span></div></div><div class='settings-group-header'> \u70b9\u4e91</div><div class='settings-group settings-group-general'><div class='settings-block'><span> \u5141\u8bb8\u63d0\u793a\u56fe\u6807:</span><input type='checkbox' id='"+
this.containerId+"settings-splat-rendering-enabled' /><span id='"+this.containerId+"settings-splat-enabled-style' class='grayed-out right-align'><label> \u5927\u5c0f: </label><input id='"+this.containerId+"settings-splat-rendering-size' step='.01' type='number' /><label> \u6a21\u5f0f:</label><select id='"+this.containerId+"settings-splat-rendering-point-size-unit'><option value='0'> \u5c4f\u5e55\u50cf\u7d20</option><option value='1'> CSS\u50cf\u7d20</option><option value='2'> \u4e16\u754c</option><option value='3'> \u5c4f\u5e55\u5bbd</option><option value='4'> \u5c4f\u5e55\u9ad8</option><option value='5'> \u8fb9\u754c\u5bf9\u89d2\u7ebf</option></select></span></div><div class='settings-block'><span> \u5141\u8bb8\u53ef\u89c1\u5149:</span><input type='checkbox' id='"+
this.containerId+"settings-eye-dome-lighting-enabled' class='right-align' /><span class='clear-both'></span></div></div><div class='settings-group-header'>Color</div><div class='settings-group settings-group-colors'><div class='settings-block'><div> \u80cc\u666f\u989c\u8272:</div><div><input type='text' id='"+this.containerId+"settings-background-top' class='color-picker' data-position='top left' /><label> \u9876\u90e8\u989c\u8272</label></div><div><input type='text' id='"+this.containerId+"settings-background-bottom' class='color-picker' data-position='top left' /><label> \u5e95\u90e8\u989c\u8272</label></div></div><div class='settings-block'><div> \u51e0\u4f55\u8986\u76d6:</div><div><input type='text' id='"+
this.containerId+"settings-capping-face-color' class='color-picker' data-position='top left' /><label> \u9762</label></div><div><input type='text' id='"+this.containerId+"settings-capping-line-color' class='color-picker' data-position='top left' /><label> \u7ebf</label></div></div><div class='settings-block'><div> \u9009\u4e2d\u989c\u8272:</div><input type='text' id='"+this.containerId+"settings-selection-color-body' class='color-picker' data-position='top left' /><label> \u5b9e\u4f53</label><div><span id='"+
this.containerId+"settings-selection-color-face-line-style'><input type='text' id='"+this.containerId+"settings-selection-color-face-line' class='color-picker' data-position='top left' /><label> \u9762\u548c\u7ebf</label></span></div></div><div class='settings-block'><input type='text' id='"+this.containerId+"settings-measurement-color' class='color-picker' data-position='top left' /><label>\u6d4b\u91cf\u5c3a\u989c\u8272</label></div><div class='settings-block'><span id='"+this.containerId+"settings-pmi-color-style' class='grayed-out'><input type='text' id='"+
this.containerId+"settings-pmi-color' class='color-picker' data-position='top left' disabled /><label>PMI \u91cd\u7ed8\u989c\u8272</label></span><input type='checkbox' id='"+this.containerId+"settings-pmi-enabled' /><label>\u5141\u8bb8</label></div></div></div><div><div class='carsview-ui-window-footer'><div class='version'>CarsView \u7248\u672c\u53f7: <span id='"+this.containerId+"settings-viewer-version'></span>, \u8f6c\u6362\u683c\u5f0f\u7248\u672c\u53f7 : <span id='"+this.containerId+"settings-format-version'></span></div><div class='carsview-ui-footer-buttons'><button id='"+
this.containerId+"viewer-settings-ok-button' style='font-size: 13px;'>\u786e\u5b9a</button><button id='"+this.containerId+"viewer-settings-cancel-button' style='font-size: 13px;'>\u53d6\u6d88</button><button id='"+this.containerId+"viewer-settings-apply-button' style='font-size: 13px;'>\u5e94\u7528</button></div></div></div></div>",c=this.containerId+"snapshot-dialog",c="<div id='"+c+"' style='display:none;position:absolute;z-index: 10000;background: rgba(100,100,100,0.8);border: 1px solid black;border-radius: 6px;overflow: hidden;border-style: solid;background: rgba(0,0,0,0);'><div class='carsview-ui-window-header'>\u5feb\u7167</div><div class='carsview-ui-window-body'><img id='"+
c+"-image' class='snapshot-image' alt='\u622a\u56fe'/><div class='snapshot-text'>\u8bf7\u60a8\u70b9\u51fb\u53f3\u952e\u6765\u4fdd\u5b58\u56fe\u7247</div></div><div class='carsview-ui-window-footer'><div class='carsview-ui-footer-buttons'><button id='"+c+"-cancel-button'style='font-size: 13px;'>\u5173\u95ed</button></div></div></div>";document.getElementById(this.containerId).insertAdjacentHTML("beforeEnd",b+a);document.body.insertAdjacentHTML("beforeEnd",c);return 0};e.prototype.setToolBar=function(a){if(null==
a||"boolean"!=typeof a)return-1;a?$("#"+this.containerId+"toolBar").show():$("#"+this.containerId+"toolBar").hide();return 0};e.prototype.setGuidMap=function(){var a=(new Date).getTime();this.guidsMap=new Map;var b=this.hwv.getModel(),c=b.getRootNode(),d=[];for(d.push(c);0<d.length;){var f=d.shift(),c=b.getNodeName(f),c=c.toLowerCase();if("body"!=c&&"instance"!=c){this.guidsMap.set(c,f);for(var f=b.getNodeChildren(f),g=0;g<f.length;g++)c=b.getNodeName(f[g]),c=c.toLowerCase(),"body"!=c&&"instance"!=
c&&d.push(f[g])}}b=(new Date).getTime();console.log("\u65f6\u95f4:"+(b-a)+"\n")};e.prototype.getNodeIdFromGuid=function(a){if(""==a||void 0==a||"string"!=typeof a)return-1;a=a.toLowerCase();if(null==this.guidsMap){this.guidsMap=new Map;var b=this.hwv.getModel(),c=b.getRootNode(),d=[];for(d.push(c);0<d.length;){var c=d.shift(),f=b.getNodeName(c),f=f.toLowerCase();this.guidsMap[f]=c;c=b.getNodeChildren(c);for(f=0;f<c.length;f++)d.push(c[f])}}return this.guidsMap.get(a)};e.prototype.setNodeCount=function(){if("object"!=
typeof this.hwv||null==this.hwv||void 0==this.hwv)return-1;if(null==this.guidsMap||void 0==this.guidsMap){var a=this.hwv.getModel(),b=a.getRootNode(),c=[];c.push(b);for(b=-1;0<c.length;){var d=c.shift();b<d&&876543210!=d&&(b=d);for(var d=a.getNodeChildren(d),f=0;f<d.length;f++)c.push(d[f])}this.nodeCount=b}else this.nodeCount=this.guidsMap.length;return 0};e.prototype.initTreeWithJson=function(a){var b=this;if("object"!=typeof a||null==a||void 0==a||""==a)return-1;document.getElementById("treeContainer").innerHTML=
"&nbsp;&nbsp;&nbsp;\u6811\u5f62\u7ed3\u6784&nbsp;&nbsp;&nbsp;";var c=a.model_tree;layui.use("tree",function(){layui.tree({elem:"#treeContainer",check:"checkbox",skin:"as",drag:!0,checkboxName:"aa[]",checkboxStyle:"",click:function(a){a=$(a).attr("rbimid");b.unSetAllModelColor();var d=[];d.push(a);b.setModelColorWithGuids(d,0,0,255);$.ajax({url:"http://61.237.239.100:28181/hoopsAPI/API/ModelData/ModelProperty/"+b.modelName+"/"+a,type:"GET",data:{},dataType:"json",success:function(a){b.setProperty(a)},
complete:function(a){200!=a.status&&alert("\u5c5e\u6027\u83b7\u53d6\u5931\u8d25")}})},onchange:function(){var a=$(this).is(":checked");if(void 0!=a&&1==a){a=$(this).attr("data-nodename");if(""==a||null==a)return-1;a=b.setHiddenWithGuids([a],!0)}else{a=$(this).attr("data-nodename");if(""==a||null==a)return-1;a=b.setHiddenWithGuids([a],!1)}return 0<=a?0:-1},nodes:c})});return 0};e.prototype.isShowTree=function(a){return null==a||"boolean"!=typeof a?-1:0};e.prototype.setProperty=function(a){if("object"!=
typeof a||null==a||void 0==a||""==a)return-1;var b="<table cellpadding='0' cellspacing='0' border='1 #999999 solid' color='#333' line-height='24px'font-size='12px' background='#FFF' border-collapse='collapse' height='auto' top='10px' left='3px' bottom='3px' width='100%' font-family='\u5fae\u8f6f\u96c5\u9ed1' onMouseOver='_this.tableColor(this)'><tr background='#666' color='#FFF' text-align='center'><th>\u5c5e\u6027\u540d\u5b57</th><th>\u5c5e\u6027\u503c</th></tr>";a=a.model_property;for(var c=0;c<
a.length;c++)b+="<tr background='#666' color='#FFF' text-align='center'>",b+="<th>"+a[c].name+"</th>",b+="<th>"+a[c].value+"</th>",b+="</tr>";b+="</table>";document.getElementById("propertyTable").innerHTML="<div class='tabTitle'>\u8282\u70b9\u5c5e\u6027</div>";document.getElementById("propertyTable").innerHTML=document.getElementById("propertyTable").innerHTML+b;return 0};e.prototype.tableColor=function(a){var b=a.getElementsByTagName("tr").length;a=a.getElementsByTagName("tr");for(var c=1;c<=b;c++)a.item(c)&&
(a.item(c).onmouseover=function(){this.style.background="#39b7ff";this.style.color="#ffffff"},a.item(c).onmouseout=function(){this.style.background="#ffffff";this.style.color="#333333"})};e.prototype.setIsProxy=function(a){if(null==a||"boolean"!=typeof a)return-1;this.isProxy=a;return 0};e.prototype.setRendererType=function(a){if("string"!=typeof a)return-1;if(null==a||""==a)this.rendererType=Communicator.RendererType.Client;else{if("ssr"!=a&&"csr"!=a)return-1;"ssr"==a?this.rendererType=Communicator.RendererType.Server:
"csr"==a&&(this.rendererType=Communicator.RendererType.Client)}return 0};e.prototype.openModel=function(a){var b=this;if(null==a||""==a||"string"!=typeof a||null==b.rendererType)return-1;window.localStorage.getItem("token");b.modelName=a;var c=new Communicator.ServiceBroker("http://61.237.239.100:11182"),d=new Communicator.ServiceRequest(b.rendererType==Communicator.RendererType.Client?Communicator.ServiceClass.CSR_Session:Communicator.ServiceClass.SSR_Session);return new Promise(function(f,g){c.request(d).then(function(d){if(d.getIsOk()){var c=
d.getEndpoints().hasOwnProperty(Communicator.ServiceProtocol.WS)?Communicator.ServiceProtocol.WS:Communicator.ServiceProtocol.WSS;d=d.getEndpoints()[c];b.isProxy&&(d=b.urlReWrite(d));d=new Communicator.WebViewer({containerId:b.containerId,endpointUri:d,model:a,rendererType:b.rendererType,streamingMode:b.streamingMode,memoryLimit:b.memoryLimit});f(d)}else g(d.getReason())},function(a){g("\u65e0\u6cd5\u8fde\u63a5\u5230\u4e2d\u95f4\u670d\u52a1\u5668: "+serviceBrokerUri)})})};e.prototype.openModelByProgress=
function(a,b){var c=this;if(null==a||""==a||"string"!=typeof a||null==c.rendererType)return-1;var d=new Communicator.ServiceBroker(window.location.protocol+"//"+window.location.hostname+":11182"),f=new Communicator.ServiceRequest(c.rendererType==Communicator.RendererType.Client?Communicator.ServiceClass.CSR_Session:Communicator.ServiceClass.SSR_Session);(new Promise(function(b,l){d.request(f).then(function(d){if(d.getIsOk()){var f=d.getEndpoints().hasOwnProperty(Communicator.ServiceProtocol.WS)?Communicator.ServiceProtocol.WS:
Communicator.ServiceProtocol.WSS;d=d.getEndpoints()[f];isProxy&&(d=c.urlReWrite(d));d=new Communicator.WebViewer({containerId:c.containerId,endpointUri:d,model:a,rendererType:c.rendererType,streamingMode:c.streamingMode,memoryLimit:c.memoryLimit});b(d)}else l(d.getReason())},function(a){l("\u65e0\u6cd5\u8fde\u63a5\u5230\u670d\u52a1\u4ee3\u7406: "+serviceBrokerUri)})})).then(function(a){c.hwv=a;window.onresize=function(a){"function"!==typeof a.target.getAttribute&&c.hwv.resizeCanvas()};var d=document.getElementById(b),
f=document.createElement("div");f.id="streamingIndicator";d.appendChild(f);c.hwv.getRendererType()==Communicator.RendererType.Client&&new Communicator.Ui.StreamingIndicator(f.id,a);d=c.hwv.start();c.hwv.getView().getNavCube().disable();c.cuttingPlaneController=new Communicator.Ui.CuttingPlaneController(a);if(!d)return-1},function(a){var b=new Communicator.Ui.UiDialog(c.containerId);b.setTitle("\u9519\u8bef\u9875\u9762");b.setText(a);b.show()});return 0};e.prototype.setBackgroundColor=function(a,b,
c,d,f,g){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||null==a||null==b||null==c||null==d||null==f||null==g||255<a||255<b||255<c||255<d||255<f||255<g||"number"!=typeof a||"number"!=typeof b||"number"!=typeof c||"number"!=typeof d||"number"!=typeof f||"number"!=typeof g||!(this.isPInt(a)&&this.isPInt(b)&&this.isPInt(c)&&this.isPInt(d)&&this.isPInt(f)&&this.isPInt(g)))return-1;this.hwv.getView().setBackgroundColor(new Communicator.Color(a,b,c),new Communicator.Color(d,f,g));return 0};
e.prototype.setAxisTriad=function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||"boolean"!=typeof a||void 0==a)return-1;a?this.hwv._view._axisTriad.enable():this.hwv._view._axisTriad.disable();return 0};e.prototype.setNavCube=function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||"boolean"!=typeof a)return-1;a?this.hwv.getView().getNavCube().enable():this.hwv.getView().getNavCube().disable();return 0};e.prototype.setExplode=function(a){if("object"!=typeof this.hwv||
null==this.hwv||void 0==this.hwv||null==a||"number"!=typeof a||0>a||1<a)return-1;var b=this.hwv.getExplodeManager();b.getActive()||b.start();b.setMagnitude(a);return 0};e.prototype.setAntiAliasingMode=function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||"string"!=typeof a||"SMAA"!=a&&"NONE"!=a)return-1;if(""==a||null==a||void 0==a)a="SMAA";"SMAA"==a.toUpperCase()?this.hwv.getView().setAntiAliasingMode(Communicator.AntiAliasingMode.SMAA):"NONE"==a.toUpperCase()&&this.hwv.getView().setAntiAliasingMode(Communicator.AntiAliasingMode.None);
return 0};e.prototype.saveSnapshotPhoto=function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||"string"!=typeof a||null==a||""==a||void 0==a)return-1;a=document.getElementById(a);var b=a.offsetHeight,c=this.hwv._view.getCanvasSize(),d=.7*b+40,f=new Communicator.Ui.SnapShot(this.containerId),g=document.createElement("div");g.id="snapshotDiv";a.appendChild(g);f.start(this.hwv,c.x,c.y).then(function(a){document.getElementById(g.id).style.backgroundImage="url('"+a.src+"')";document.getElementById(g.id).style.backgroundRepeat=
"no-repeat";document.getElementById(g.id).style.backgroundPosition="center";document.getElementById(g.id).style.width=b;document.getElementById(g.id).style.height=d;$("#"+g.id).dialog({title:"\u6a21\u578b\u5c4f\u5e55\u5feb\u7167",collapsible:!0,minimizable:!0,maximizable:!0,width:1E3,height:500,closed:!1,cache:!1,modal:!0,iconCls:"icon-save",buttons:[{text:"\u4fdd\u5b58\u56fe\u7247",iconCls:"icon-save",handler:function(){alert("save")}}]})});return 0};e.prototype.setStandardView=function(){return this.setViewOrientation("ISO",
400)};e.prototype.setViewOrientation=function(a,b){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||"string"!=typeof a||null==a||""==a||"TOP"!=a&&"ISO"!=a&&"BOTTOM"!=a&&"RIGHT"!=a&&"LEFT"!=a&&"BACK"!=a&&"FRONT"!=a||"number"!=typeof b||null==b||""==b||!this.isPInt(b)||0>b||1E3<b)return-1;switch(a.toUpperCase()){case "TOP":this.hwv._view.setViewOrientation(Communicator.ViewOrientation.Top,b);break;case "ISO":this.hwv._view.setViewOrientation(Communicator.ViewOrientation.Iso,b);break;
case "BOTTOM":this.hwv._view.setViewOrientation(Communicator.ViewOrientation.Bottom,b);break;case "RIGHT":this.hwv._view.setViewOrientation(Communicator.ViewOrientation.Right,b);break;case "LEFT":this.hwv._view.setViewOrientation(Communicator.ViewOrientation.Left,b);break;case "BACK":this.hwv._view.setViewOrientation(Communicator.ViewOrientation.Back,b);break;case "FRONT":this.hwv._view.setViewOrientation(Communicator.ViewOrientation.Front,b)}return 0};e.prototype.setModelProjection=function(a){if("object"!=
typeof this.hwv||null==this.hwv||void 0==this.hwv||"string"!=typeof a||null==a||""==a||void 0==a||"ORTHOGRAPHIC"!=a&&"PERSPECTIVE"!=a)return-1;switch(a.toUpperCase()){case "ORTHOGRAPHIC":this.hwv._view.setProjectionMode(Communicator.Projection.Orthographic);break;case "PERSPECTIVE":this.hwv._view.setProjectionMode(Communicator.Projection.Perspective)}return 0};e.prototype.setModelDrawMode=function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||"string"!=typeof a||""==a||null==
a||void 0==a)return-1;if("HIDDENLINE"!=a&&"SHADED"!=a&&"WIREFRAME"!=a&&"WIREFRAMEONSHADED"!=a&&"XRAY"!=a)switch(a.toUpperCase()){case "HIDDENLINE":this.hwv.getView().setDrawMode(Communicator.DrawMode.HiddenLine);break;case "SHADED":this.hwv.getView().setDrawMode(Communicator.DrawMode.Shaded);break;case "WIREFRAME":this.hwv.getView().setDrawMode(Communicator.DrawMode.Wireframe);break;case "WIREFRAMEONSHADED":this.hwv.getView().setDrawMode(Communicator.DrawMode.WireframeOnShaded);break;case "XRAY":this.hwv.getView().setDrawMode(Communicator.DrawMode.XRay)}return 0};
e.prototype.setModelSelect=function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||"string"!=typeof a||null==a||void 0==a||"TEXT"!=a&&"RECTANGLE"!=a&&"POLYLINE"!=a&&"CIRCLE"!=a&&"NOTE"!=a&&"NONE"!=a&&"SELECT"!=a&&"AREASELECT"!=a&&"CUTTING"!=a&&"HANDLE"!=a&&"MEASUREFACEFACEANGLE"!=a&&"MEASUREFACEFACEDISTANCE"!=a&&"MEASUREPOINTPOINTDISTANCE"!=a&&"MEASUREEDGELENGTH"!=a&&"NAVIGATE"!=a&&"TURNTABLE"!=a&&"WALK"!=a&&"ZOOM"!=a&&"NAVCUBE"!=a&&"ORBIT"!=a&&"PAN"!=a)return-1;null==this.hwv.getMarkupManager().getActiveMarkupView()&&
this.hwv.getMarkupManager().createMarkupView();var b=-1;switch(a.toUpperCase()){case "TEXT":b=this.hwv.getOperatorManager().set(Communicator.OperatorId.RedlineText,1);break;case "RECTANGLE":b=this.hwv.getOperatorManager().set(Communicator.OperatorId.RedlineRectangle,1);break;case "POLYLINE":b=this.hwv.getOperatorManager().set(Communicator.OperatorId.RedlinePolyline,1);break;case "CIRCLE":b=this.hwv.getOperatorManager().set(Communicator.OperatorId.RedlineCircle,1);break;case "NOTE":b=this.hwv.getOperatorManager().set(Communicator.OperatorId.Note,
1);break;case "NONE":b=this.hwv.getOperatorManager().set(Communicator.OperatorId.None,1);break;case "SELECT":b=this.hwv.getOperatorManager().set(Communicator.OperatorId.Select,1);break;case "AREASELECT":b=this.hwv.getOperatorManager().set(Communicator.OperatorId.AreaSelect,1);break;case "CUTTING":b=this.hwv.getOperatorManager().set(Communicator.OperatorId.Cutting,1);break;case "HANDLE":b=this.hwv.getOperatorManager().set(Communicator.OperatorId.Handle,1);break;case "MEASUREFACEFACEANGLE":b=this.hwv.getOperatorManager().set(Communicator.OperatorId.MeasureFaceFaceAngle,
1);break;case "MEASUREFACEFACEDISTANCE":b=this.hwv.getOperatorManager().set(Communicator.OperatorId.MeasureFaceFaceDistance,1);break;case "MEASUREPOINTPOINTDISTANCE":b=this.hwv.getOperatorManager().set(Communicator.OperatorId.MeasurePointPointDistance,1);break;case "MEASUREEDGELENGTH":b=this.hwv.getOperatorManager().set(Communicator.OperatorId.MeasureEdgeLength,1);break;case "NAVIGATE":b=this.hwv.getOperatorManager().set(Communicator.OperatorId.Navigate,0);break;case "TURNTABLE":b=this.hwv.getOperatorManager().set(Communicator.OperatorId.Turntable,
0);break;case "WALK":b=this.hwv.getOperatorManager().set(Communicator.OperatorId.Walk,0);break;case "ZOOM":b=this.hwv.getOperatorManager().set(Communicator.OperatorId.Zoom,1);break;case "NAVCUBE":b=this.hwv.getOperatorManager().set(Communicator.OperatorId.NavCube,1);break;case "ORBIT":b=this.hwv.getOperatorManager().set(Communicator.OperatorId.Orbit,1);break;case "PAN":b=this.hwv.getOperatorManager().set(Communicator.OperatorId.Pan,1)}return b?0:-1};e.prototype.setHidden=function(a,b){if("object"!=
typeof this.hwv||null==this.hwv||void 0==this.hwv||null==b||"boolean"!=typeof b||void 0==b||null==a||void 0==a||0>a||"number"!=typeof a||!this.isPInt(a)||this.nodeCount<a)return-1;this.hwv.getModel().setNodesVisibility([a],b);return 0};e.prototype.setHiddenWithGuids=function(a,b){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||null==b||"boolean"!=typeof b||void 0==b||"object"!=typeof a||null==a||void 0==a)return-1;for(var c=[],d=0;d<a.length;d++){var f=this.getNodeIdFromGuid(a[d]);
if(this.nodeCount<f||-1==f||void 0==f)return-1;c.push(f)}return this.hwv.getModel().setNodesVisibility(c,b)};e.prototype.setNoHidden=function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||null==a||void 0==a||0>a||"number"!=typeof a||!this.isPInt(a)||this.nodeCount<a)return-1;this.hwv.getModel().setNodesVisibility([0],!1);this.hwv.getModel().setNodesVisibility([a],!0);return 0};e.prototype.setNoHiddenWithGuid=function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||
"string"!=typeof a||null==a||void 0==a)return-1;a=this.getNodeIdFromGuid(a);var b=-1;-1!=a&&(b=this.setNoHidden(a));return b};e.prototype.setAllNoHidden=function(){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv)return-1;this.hwv.getModel().setNodesVisibility([0],!0);return 0};e.prototype.setPartSelect=function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||null==a||void 0==a||0>a||"number"!=typeof a||!this.isPInt(a)||this.nodeCount<a)return-1;var b=this.hwv.getModel(),
c=[];c.push(a);a=b.getNodeChildren(a);for(var d=0;d<a.length;d++)c.push(a[d]);b.setNodesHighlighted(c,!0);return 0};e.prototype.setPartAndParentsSelect=function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||null==a||void 0==a||0>a||"number"!=typeof a||!this.isPInt(a)||this.nodeCount<a)return-1;var b=this.hwv.getModel(),c=[];a=b.getNodeParent(a);c.push(a);b.setNodesHighlighted(c,!0);return 0};e.prototype.setPartAndGrandfatherSelect=function(a){if("object"!=typeof this.hwv||null==
this.hwv||void 0==this.hwv||null==a||void 0==a||0>a||"number"!=typeof a||!this.isPInt(a)||this.nodeCount<a)return-1;var b=this.hwv.getModel(),c=[];a=b.getNodeParent(a);a=b.getNodeParent(a);c.push(a);b.setNodesHighlighted(c,!0);return 0};e.prototype.isPInt=function(a){return"number"!=typeof a||null==a||void 0==a?!1:0==a?!0:/^[0-9]*[1-9][0-9]*$/.test(a)};e.prototype.setModelColor=function(a,b,c,d){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||null==a||void 0==a||0>a||"number"!=typeof a||
null==b||void 0==b||0>b||255<b||"number"!=typeof b||null==c||void 0==c||0>c||255<c||"number"!=typeof c||null==d||void 0==d||0>d||255<d||"number"!=typeof d||!(this.isPInt(b)&&this.isPInt(c)&&this.isPInt(d)&&this.isPInt(a))||this.nodeCount<a)return-1;this.hwv.getModel().setNodesFaceColor([a],new Communicator.Color(b,c,d));return 0};e.prototype.setModelColorWithGuids=function(a,b,c,d){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||"object"!=typeof a||null==a||void 0==a||0>=a.length||
null==b||void 0==b||0>b||255<b||"number"!=typeof b||null==c||void 0==c||0>c||255<c||"number"!=typeof c||null==d||void 0==d||0>d||255<d||"number"!=typeof d||!this.isPInt(b)||!this.isPInt(c)||!this.isPInt(d))return-1;for(var f=[],g=0;g<a.length;g++){var l=this.getNodeIdFromGuid(a[g]);if(this.nodeCount<l||-1==l||void 0==l)return-1;f.push(l)}return this.setModelsColor(f,b,c,d)};e.prototype.setModelsColor=function(a,b,c,d){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||"object"!=typeof a||
null==a||void 0==a||0>=a.length||null==b||void 0==b||0>b||255<b||"number"!=typeof b||null==c||void 0==c||0>c||255<c||"number"!=typeof c||null==d||void 0==d||0>d||255<d||"number"!=typeof d||!this.isPInt(b)||!this.isPInt(c)||!this.isPInt(d))return-1;this.hwv.getModel().setNodesFaceColor(a,new Communicator.Color(b,c,d));return 0};e.prototype.unSetAllModelColor=function(){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv)return-1;this.hwv.getModel().resetNodesColor();return 0};e.prototype.unSetModelColor=
function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||null==a||void 0==a||0>a||"number"!=typeof a||!this.isPInt(a)||this.nodeCount<a)return-1;this.hwv.getModel().unsetNodesFaceColor(a);return 0};e.prototype.unSetModelColorWithGuids=function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||"object"!=typeof a||null==a||void 0==a||0>=a.length)return-1;for(var b=[],c=0;c<a.length;c++){var d=this.getNodeIdFromGuid(a[c]);if(this.nodeCount<d||-1==d||void 0==d)return-1;
b.push(d)}this.hwv.getModel().unsetNodesFaceColor(b)};e.prototype.setCeshiIds=function(a){this.hwv.getModel().setNodesTransparency(a,.5)};e.prototype.setCeshiIds=function(a){this.hwv.getModel().setNodesTransparency(a,.5)};e.prototype.setModelTransparency=function(a,b){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||null==a||void 0==a||0>a||"number"!=typeof a||!this.isPInt(a)||null==b||void 0==b||0>b||1<b||"number"!=typeof b||0>b||1<b||a>this.nodeCount)return-1;this.hwv.getModel().setNodesTransparency([a],
b);return 0};e.prototype.setTransparencyWithGuids=function(a,b){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||"object"!=typeof a||null==a||void 0==a||0>=a.length||null==b||void 0==b||0>b||1<b||"number"!=typeof b||0>b||1<b)return-1;for(var c=[],d=0;d<a.length;d++){var f=this.getNodeIdFromGuid(a[d]);if(this.nodeCount<f||-1==f||void 0==f)return-1;c.push(f)}return this.hwv.getModel().setNodesTransparency(c,b)};e.prototype.setLogoVersionInfo=function(){var a=document.getElementById(this.containerId),
b=document.createElement("div");b.id=this.containerId+"carsLogo";b.classList.add("carsLogo");a.appendChild(b);a=document.createElement("div");a.id=this.containerId+"logo";a.classList.add("logo");b.appendChild(a);var c=document.createElement("div");c.id=this.containerId+"version";c.classList.add("version");b.appendChild(c);document.getElementById(b.id).style.display="block";document.getElementById(a.id).style.backgroundImage="url('images/logo.png')";document.getElementById(c.id).innerText="V 1.0.0";
return 0};e.prototype.progressBar=function(a,b){if("string"!=typeof a||null==a||""==a||"string"!=typeof b||null==b||""==b)return!1;document.getElementById(b).style.width=parseInt(document.getElementById(b).style.width)+1+"%";document.getElementById(b).innerHTML=document.getElementById(b).style.width;"100%"==document.getElementById(b).style.width&&(document.getElementById(a).style.display="none",window.clearInterval(this.bar));return!0};e.prototype.setLoadProgress=function(a,b,c){var d=this;if("string"!=
typeof a||null==a||""==a||"string"!=typeof b||null==b||""==b||"number"!=typeof c||null==c||0>c||!d.isPInt(c))return-1;document.getElementById(a).style.display="block";d.bar=window.setInterval(function(){d.progressBar(a,b)},c);return 0};e.prototype.unSetModelTransparency=function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||null==a||void 0==a||0>a||"number"!=typeof a||!this.isPInt(a)||a>this.nodeCount)return-1;this.hwv.getModel().resetNodesTransparency([a]);return 0};e.prototype.unSetModelTransparencyWithGuid=
function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||"string"!=typeof a||null==a||void 0==a)return-1;a=this.getNodeIdFromGuid(a);var b=-1;-1!=a&&(b=this.unSetModelTransparency(a));return b};e.prototype.unSetAllModelTransparency=function(){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv)return-1;this.hwv.getModel().resetModelTransparency();return 0};e.prototype.unSetAllModelVisibility=function(){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv)return-1;
this.hwv.getModel().resetNodesVisibility();return 0};e.prototype.unSetAllModel=function(){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv)return-1;this.hwv.getModel().reset();return 0};e.prototype.isolateAndCenterWithGuid=function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||"object"!=typeof a||null==a||void 0==a||0>=a.length)return-1;for(var b=[],c=0;c<a.length;c++){var d=this.getNodeIdFromGuid(a[c]);if(d>this.nodeCount||-1==d||void 0==d)return-1;b.push(d)}(new Communicator.IsolateZoomHelper(this.hwv)).isolateNodes(b);
return 0};e.prototype.isolateAndCenter=function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||null==a||void 0==a||0>a||"number"!=typeof a||!this.isPInt(a)||a>this.nodeCount)return-1;(new Communicator.IsolateZoomHelper(this.hwv)).isolateNodes([a]);return 0};e.prototype.selectedAndCenter=function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||null==a||void 0==a||0>a||"number"!=typeof a||!this.isPInt(a)||a>this.nodeCount)return-1;(new Communicator.IsolateZoomHelper(this.hwv)).fitNodes([a]);
return 0};e.prototype.selectedAndCenterWithGuid=function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||"string"!=typeof a||null==a||void 0==a)return-1;a=this.getNodeIdFromGuid(a);var b=-1;-1!=a&&(b=this.selectedAndCenter(a));return b};e.prototype.zoomFitActor=function(a,b){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||"object"!=typeof a||null==a||void 0==a||0>=a.length||null==b||void 0==b||0>b||"number"!=typeof b||!this.isPInt(b))return-1;for(var c=[],d=0;d<
a.length;d++){var f=this.getNodeIdFromGuid(a[d]);if(f>this.nodeCount||-1==f||void 0==f)return-1;c.push(f)}this.hwv.getView().fitNodes(c,b);return 0};e.prototype.showAll=function(){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv)return-1;(new Communicator.IsolateZoomHelper(this.hwv)).showAll();this.hwv.getView().fitWorld(0,null);return 0};e.prototype.getGuidFromNodeId=function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||null==a||void 0==a||0>a||"number"!=typeof a||
!this.isPInt(a))return-1;for(var b=this.hwv.getModel();876543210!=a&&0!=b.getNodeType(a);)a=b.getNodeParent(a);return 876543210==a?0:0==b.getNodeType(a)?b.getNodeName(a):-1};e.prototype.setFps=function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||null==a||void 0==a||0>a||"number"!=typeof a||!this.isPInt(a))return-1;this.hwv.setMinimumFramerate(a);return 0};e.prototype.shutDown=function(){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv)return-1;this.hwv.shutdown();
document.getElementById(this.containerId).innerHTML="";this.hwv=null;return 0};e.prototype.removeNodesWithGuids=function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||"object"!=typeof a||null==a||void 0==a||0>=a.length)return-1;for(var b=0;b<a.length;b++){var c=this.getNodeIdFromGuid(a[b]);if(c>this.nodeCount||-1==c||void 0==c||null==c)return-1;this.hwv.getModel().deleteNode(c)}return 0};e.prototype.resetAll=function(){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv)return-1;
this.hwv.reset();return 0};e.prototype.getTrianglePatchCount=function(){return"object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv?-1:this.hwv.getStatistics(!0)};e.prototype.singlePartsOperation=function(a){return"object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||null==a||void 0==a||0>a||"number"!=typeof a||!this.isPInt(a)?-1:0};e.prototype.getNodeVisibility=function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||"string"!=typeof a||null==a||void 0==a)return-1;
a=this.getNodeIdFromGuid(a);if(a>this.nodeCount||void 0==a)return-1;var b=-1;-1!=a&&(b=this.hwv.getModel().getNodeVisibility(a));return b};e.prototype.setSelection=function(a,b){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||"object"!=typeof a||null==a||void 0==a||0>=a.length||"number"!=typeof b||null==b||void 0==b||!this.isPInt(b)||0!=b&&1!=b&&2!=b)return-1;if(0==b){this.hwv.getSelectionManager().clear();b=[];for(var c=0;c<a.length;c++){var d=this.getNodeIdFromGuid(a[c]);if(d>this.nodeCount||
-1==d||void 0==d)return-1;b.push(new Communicator.Selection.SelectionItem(d))}this.hwv.getSelectionManager().add(b);return 0}if(1==b)return alert("\u9700\u6c42\u5b58\u5728\u4e89\u8bae\uff0c\u8bf7\u7a0d\u540e\u5904\u7406"),0;if(2==b){b=[];for(c=0;c<a.length;c++){d=this.getNodeIdFromGuid(a[c]);if(d>this.nodeCount||-1==d||void 0==d)return-1;b.push(new Communicator.Selection.SelectionItem(d))}this.hwv.getSelectionManager().add(b);return 0}return-1};e.prototype.zoomFitAll=function(){if("object"!=typeof this.hwv||
null==this.hwv||void 0==this.hwv)return-1;this.hwv.getView().fitWorld(400,null);return 0};e.prototype.getViewPoint=function(){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv)return-1;var a=this.hwv.getView().getCamera(),b={};b.pos=a.getPosition();b.tar=a.getTarget();b.up=a.getUp();b.projection=a.getProjection();b.width=a.getWidth();b.height=a.getHeight();b.nearLimit=a.getNearLimit();return b};e.prototype.setViewPoint=function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==
this.hwv||"object"!=typeof a||null==a||""==a||void 0==a)return-1;var b=this.hwv.getView().getCamera();b.setPosition(a.pos);b.setProjection(a.projection);b.setTarget(a.tar);b.setHeight(a.height);b.setWidth(a.width);b.setNearLimit(a.nearLimit);b.setUp(a.up);return this.hwv.getView().setCamera(b,400)?0:-1};e.prototype.getViewImage=function(){var a=this;if("object"!=typeof a.hwv||null==a.hwv||void 0==a.hwv)return-1;var b=a.hwv.getView().getCanvasSize(),c=new Communicator.Ui.SnapShot(a.containerId);return new Promise(function(d,
f){c.start(a.hwv,b.x,b.y).then(function(a){d(a)},function(){f()})})};e.prototype.addMarkupElement=function(a,b,c,d,f,g,l,e){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||null==a||void 0==a||"number"!=typeof a||null==b||void 0==b||"number"!=typeof b||null==c||void 0==c||"number"!=typeof c||null==d||void 0==d||"number"!=typeof d||null==f||void 0==f||"number"!=typeof f||null==g||void 0==g||"number"!=typeof g||null==e||void 0==e||0>e||"number"!=typeof e||!this.isPInt(e)||null==l||void 0==
l||"string"!=typeof l)return-1;null==this.hwv.getMarkupManager().getActiveMarkupView()&&this.hwv.getMarkupManager().createMarkupView();(new Communicator.Markup.NoteText(this.hwv,new Communicator.Point3(d,f,g),new Communicator.Point3(a,b,c),e))._text=l;return 0};e.prototype.addMarkupElementFromGuid=function(a,b){var c=this;if("object"!=typeof c.hwv||null==c.hwv||void 0==c.hwv||null==b||void 0==b||"string"!=typeof b||null==a||void 0==a||"string"!=typeof a)return-1;var d=c.getNodeIdFromGuid(b);return-1!=
d&&void 0!=d?(null==c.hwv.getMarkupManager().getActiveMarkupView()&&c.hwv.getMarkupManager().createMarkupView(),c.hwv.getModel().getNodesBounding([d]).then(function(b){b=b.center();b=Communicator.Point2.fromPoint3(c.hwv.getView().projectPoint(b));var f=new Communicator.PickConfig(Communicator.SelectionMask.Face);c.hwv.getView().pickFromPoint(b,f).then(function(b){(new Communicator.Markup.NoteText(c.hwv,b.getFaceEntity().getPosition(),b.getFaceEntity().getNormal(),d))._text=a})}),0):-1};e.prototype.addMarkupElementWithPosition=
function(a,b,c,d,f){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||null==a||void 0==a||"string"!=typeof a||null==b||void 0==b||0>b||255<b||"number"!=typeof b||null==c||void 0==c||0>c||255<c||"number"!=typeof c||null==d||void 0==d||0>d||255<d||"number"!=typeof d||!this.isPInt(b)||!this.isPInt(c)||!this.isPInt(d))return-1;f=new Communicator.Point3(f.x,f.y,f.z);null==this.hwv.getMarkupManager().getActiveMarkupView()&&this.hwv.getMarkupManager().createMarkupView();var g=new Communicator.Point3(1,
0,0);f=new Communicator.Markup.NoteText(this.hwv,f,g,0);b=new Communicator.Color(b,c,d);f.setColor(b);f._text=a;return 0};e.prototype.addImgMarkupFromGuid=function(a,b){var c=this;if("object"!=typeof c.hwv||null==c.hwv||void 0==c.hwv||null==b||void 0==b||"string"!=typeof b||null==a||void 0==a||"string"!=typeof a)return-1;var d=c.getNodeIdFromGuid(b);return-1!=d&&void 0!=d?(null==c.hwv.getMarkupManager().getActiveMarkupView()&&c.hwv.getMarkupManager().createMarkupView(),b=c._annotationMap.get(d),void 0==
b||null==b?(c._annotationMap.set(d,1),b=1):c._annotationMap.set(d,b+1),c.hwv.getModel().getNodesBounding([d]).then(function(b){b=b.center();b=Communicator.Point2.fromPoint3(c.hwv.getView().projectPoint(b));var f=new Communicator.PickConfig(Communicator.SelectionMask.Face);c.hwv.getView().pickFromPoint(b,f).then(function(b){(new Communicator.Markup.ImgMarkup(c.hwv,b.getFaceEntity().getPosition(),b.getFaceEntity().getNormal(),d))._src=a})}),0):-1};e.prototype.addAnnotationMarkupFromGuid=function(a,
b){var c=this;if("object"!=typeof c.hwv||null==c.hwv||void 0==c.hwv||null==b||void 0==b||"string"!=typeof b||null==a||void 0==a||"string"!=typeof a)return-1;b=c.getNodeIdFromGuid(b);if(-1!=b&&void 0!=b){null==c.hwv.getMarkupManager().getActiveMarkupView()&&c.hwv.getMarkupManager().createMarkupView();var d=c._annotationMap.get(b);void 0==d||null==d?(c._annotationMap.set(b,1),d=1):(d+=1,c._annotationMap.set(b,d));c.hwv.getModel().getNodesBounding([b]).then(function(b){b=b.center();var f=b.copy();f.set(f.x+
2*d,f.y+3*d,f.z+4*d);b=new Communicator.Markup.AnnotationMarkup(c.hwv,b,a,f);c.hwv.getMarkupManager().registerMarkup(b)});return 0}return-1};e.prototype.addAnnotationMarkupWithPositionAndColor=function(a,b,c,d,f,g,e,h){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||null==a||void 0==a||"string"!=typeof a||null==b||void 0==b||0>b||255<b||"number"!=typeof b||null==c||void 0==c||0>c||255<c||"number"!=typeof c||null==d||void 0==d||0>d||255<d||"number"!=typeof d||!this.isPInt(b)||!this.isPInt(c)||
!this.isPInt(d)||null==f||void 0==f||"number"!=typeof f||null==g||void 0==g||"number"!=typeof g||null==e||void 0==e||"number"!=typeof e)return-1;null==this.hwv.getMarkupManager().getActiveMarkupView()&&this.hwv.getMarkupManager().createMarkupView();h=new Communicator.Point3(h.x,h.y,h.z);var l=new Communicator.Point3(h.x,h.y,h.z);l.set(l.x+f,l.y+g,l.z+e);a=new Communicator.Markup.AnnotationMarkup(this.hwv,h,a,l);a.setColor(b,c,d);this.hwv.getMarkupManager().registerMarkup(a);return 0};e.prototype.getMarkupElement=
function(){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv)return-1;var a=Communicator.Markup.NoteText.getItemList();if(0>=a.length)return-1;for(var b=[],c=0;c<a.length;c++){var d=a[c],f=new Map;f.x1=d._selectionNormal.x;f.y1=d._selectionNormal.y;f.z1=d._selectionNormal.z;f.x2=d._selectionPosition.x;f.y2=d._selectionPosition.y;f.z2=d._selectionPosition.z;f.id=d._partId;f.text=d._text;b.push(f)}return b};e.prototype.addModel=function(a,b){var c=this;if("object"!=typeof c.hwv||null==
c.hwv||void 0==c.hwv)return-1;var d=c.getNodeIdFromGuid(a);return d>c.nodeCount||-1==d||void 0==d||"string"!=typeof b||null==b||""==b||void 0==b?-1:new Promise(function(a,g){c.hwv.getModel().loadSubtreeFromModel(d,b).then(function(b){c.guidsMap=null;c.nodeCount=null;c.setGuidMap();c.setNodeCount();a(b)},function(){g()})})};e.prototype.setTranslation=function(a,b,c,d){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||null==b||void 0==b||"number"!=typeof b||null==c||void 0==c||"number"!=
typeof c||null==d||void 0==d||"number"!=typeof d)return-1;var f=this.hwv.getModel().getNodeMatrix(a);f.setTranslationComponent(f.m[12]+b,f.m[13]+c,f.m[14]+d);this.hwv.getModel().setNodeMatrix(a,f);return 0};e.prototype.setRotateXY=function(a,b){var c=this;if("object"!=typeof c.hwv||null==c.hwv||void 0==c.hwv||null==b||void 0==b||"number"!=typeof b)return-1;var d=c.hwv.getModel().getNodeMatrix(a),f=new Communicator.Point3(0,0,1);d.copy().setTranslationComponent(0,0,0).transform(f,f);c.hwv.getModel().getNodesBounding([a]).then(function(g){var e=
g.center();g=(new Communicator.Matrix).setTranslationComponent(-e.copy().x,-e.copy().y,-e.copy().z);f=Communicator.Matrix.createFromOffAxisRotation(f,b);e=(new Communicator.Matrix).setTranslationComponent(e.copy().x,e.copy().y,e.copy().z);g=Communicator.Matrix.multiply(Communicator.Matrix.multiply(g,f),e);d=Communicator.Matrix.multiply(d,g);d.setTranslationComponent(d.m[12],d.m[13],d.m[14]);c.hwv.getModel().setNodeMatrix(a,d)});return 0};e.prototype.setRotateYZ=function(a,b){var c=this;if("object"!=
typeof c.hwv||null==c.hwv||void 0==c.hwv||null==b||void 0==b||"number"!=typeof b)return-1;var d=c.hwv.getModel().getNodeMatrix(a),f=new Communicator.Point3(1,0,0);d.copy().setTranslationComponent(0,0,0).transform(f,f);c.hwv.getModel().getNodesBounding([a]).then(function(g){var e=g.center();g=(new Communicator.Matrix).setTranslationComponent(-e.copy().x,-e.copy().y,-e.copy().z);f=Communicator.Matrix.createFromOffAxisRotation(f,b);e=(new Communicator.Matrix).setTranslationComponent(e.copy().x,e.copy().y,
e.copy().z);g=Communicator.Matrix.multiply(Communicator.Matrix.multiply(g,f),e);d=Communicator.Matrix.multiply(d,g);d.setTranslationComponent(d.m[12],d.m[13],d.m[14]);c.hwv.getModel().setNodeMatrix(a,d)});return 0};e.prototype.setRotateXZ=function(a,b){var c=this;if("object"!=typeof c.hwv||null==c.hwv||void 0==c.hwv||null==b||void 0==b||"number"!=typeof b)return-1;var d=c.hwv.getModel().getNodeMatrix(a),f=new Communicator.Point3(0,1,0);d.copy().setTranslationComponent(0,0,0).transform(f,f);c.hwv.getModel().getNodesBounding([a]).then(function(g){var e=
g.center();g=(new Communicator.Matrix).setTranslationComponent(-e.copy().x,-e.copy().y,-e.copy().z);f=Communicator.Matrix.createFromOffAxisRotation(f,b);e=(new Communicator.Matrix).setTranslationComponent(e.copy().x,e.copy().y,e.copy().z);g=Communicator.Matrix.multiply(Communicator.Matrix.multiply(g,f),e);d=Communicator.Matrix.multiply(d,g);d.setTranslationComponent(d.m[12],d.m[13],d.m[14]);c.hwv.getModel().setNodeMatrix(a,d)});return 0};e.prototype.setRotate=function(a,b,c,d,f){var g=this;if("object"!=
typeof g.hwv||null==g.hwv||void 0==g.hwv||null==b||void 0==b||"number"!=typeof b||null==c||void 0==c||"number"!=typeof c||null==d||void 0==d||"number"!=typeof d||null==f||void 0==f||"number"!=typeof f)return-1;var e=g.hwv.getModel().getNodeMatrix(a),h=new Communicator.Point3(b,c,d),k=new Communicator.Point3(b/h.squaredLength(),c/h.squaredLength(),d/h.squaredLength());e.copy().setTranslationComponent(0,0,0).transform(k,k);g.hwv.getModel().getNodesBounding([a]).then(function(b){var d=b.center();b=(new Communicator.Matrix).setTranslationComponent(-d.copy().x,
-d.copy().y,-d.copy().z);k=Communicator.Matrix.createFromOffAxisRotation(k,f);d=(new Communicator.Matrix).setTranslationComponent(d.copy().x,d.copy().y,d.copy().z);b=Communicator.Matrix.multiply(Communicator.Matrix.multiply(b,k),d);e=Communicator.Matrix.multiply(e,b);g.hwv.getModel().setNodeMatrix(a,e)});return 0};e.prototype.setScaleWithId=function(a,b){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||null==b||void 0==b||"number"!=typeof b)return-1;var c=this.hwv.getModel().getNodeMatrix(a);
c.scale(b);this.hwv.getModel().setNodeMatrix(a,c);return 0};e.prototype.dolly=function(a){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||"object"!=typeof a||!(a instanceof Array)||null==a||void 0==a||0>=a.length)return-1;for(var b=this.hwv.getView().getCamera(),c=b.getPosition(),d=0;d<a.length;d++){var f=a[d],f=(new Communicator.Point3(f.x,f.y,f.z)).subtract(c);b.dolly(f);this.hwv.getView().setCamera(b)}return 0};e.prototype._getTransform=function(a){a=this.getNodeIdFromGuid(a);a=
this.hwv.getModel().getNodeChildren(a);if(void 0==a||null==a||0>=a.length)return-1;var b=this.hwv.getModel().getNodeName(a[0]);if(void 0==b||null==b)return-1;b=b.substring(0,13);if("mesh-instance"!=b)return-1;a=this.hwv.getModel().getNodeChildren(a[0]);b=this.hwv.getModel().getNodeName(a[0]);if(void 0==b||null==b)return-1;b=b.substring(0,4);if("body"!=b)return-1;a=this.hwv.getModel().getNodeNetMatrix(a[0]);var b=a.m[13],c=a.m[14],d={};d.x=a.m[12];d.y=b;d.z=c;return d};e.prototype._computeVecterFromPoints=
function(a,b){var c=b.x-a.x,d=b.y-a.y;a=b.z-a.z;b=Math.sqrt(c*c+d*d+a*a);return{x:c/b,y:d/b,z:a/b}};e.prototype._computeDistanceFromPoints=function(a,b){var c=b.x-a.x,d=b.y-a.y;a=b.z-a.z;return Math.sqrt(c*c+d*d+a*a)};e.prototype._applyTransform=function(a,b){var c=b.x,d=b.y;b=b.z;return{x:a.m[0]*c+a.m[4]*d+a.m[8]*b+1*a.m[12],y:a.m[1]*c+a.m[5]*d+a.m[9]*b+1*a.m[13],z:a.m[2]*c+a.m[6]*d+a.m[10]*b+1*a.m[14]}};e.prototype._convertToLocalVector=function(a,b){a=this.hwv.getModel().getNodeParent(a);a=this.hwv.getModel().getNodeNetMatrix(a);
var c=new Communicator.Matrix.inverse(a);a=this._applyTransform(c,{x:0,y:0,z:0});b=this._applyTransform(c,b);return new Communicator.Point3(b.x-a.x,b.y-a.y,b.z-a.z)};e.prototype._convertToLocalPoint=function(a,b){a=this.hwv.getModel().getNodeParent(a);a=this.hwv.getModel().getNodeNetMatrix(a);a=new Communicator.Matrix.inverse(a);return this._applyTransform(a,b)};e.prototype.translateAnimation=function(a,b,c,d,f,g){var e=this;if("object"!=typeof e.hwv||null==e.hwv||void 0==e.hwv)return-1;if("object"==
typeof a&&null!=a&&void 0!=a&&"object"==typeof b&&null!=b&&void 0!=b&&"object"==typeof c&&null!=c&&void 0!=c&&!("number"!=typeof d||null==d||void 0==d||0>d||"number"!=typeof f||null==f||void 0==f||0>f||"object"!=typeof g||null==g||void 0==g)){c=e._computeDistanceFromPoints(b,c);var h=[];for(b=0;b<a.length;b++){var k=e.getNodeIdFromGuid(a[b]);if(k>e.nodeCount||-1==k||void 0==k)return-1;h.push(k)}var m=0;a=c/d*f;var q=d/f,r=[];for(b=0;b<h.length;b++)d=e._convertToLocalVector(h[b],g),r.push(new Communicator.Matrix),
r[b].setTranslationComponent(d.x*a,d.y*a,d.z*a);k=setInterval(function(){for(var a=0;a<h.length;a++){var b=e.hwv.getModel().getNodeMatrix(h[a]);e.hwv.getModel().setNodeMatrix(h[a],Communicator.Matrix.multiply(b,r[a]))}m++;m>=q&&clearInterval(k)},f)}};e.prototype.translateAnimationWithEndPoint=function(a,b,c,d,f){var g=this;if("object"!=typeof g.hwv||null==g.hwv||void 0==g.hwv)return-1;if("object"==typeof a&&null!=a&&void 0!=a&&"object"==typeof b&&null!=b&&void 0!=b&&!("number"!=typeof c||null==c||
void 0==c||0>c||"number"!=typeof d||null==d||void 0==d||0>d||"object"!=typeof f||null==f||void 0==f)){for(var e=[],h=0;h<a.length;h++){var k=g.getNodeIdFromGuid(a[h]);if(k>g.nodeCount||-1==k||void 0==k)return-1;e.push(k)}g.hwv.getModel().getNodesBounding(e).then(function(a){a=a.center();var l=0;a=g._computeDistanceFromPoints(a,b)/c*d;for(var h=c/d,k=[],m=0;m<e.length;m++){var n=g._convertToLocalVector(e[m],f);k.push(new Communicator.Matrix);k[m].setTranslationComponent(n.x*a,n.y*a,n.z*a)}var u=setInterval(function(){for(var a=
0;a<e.length;a++){var b=g.hwv.getModel().getNodeMatrix(e[a]);g.hwv.getModel().setNodeMatrix(e[a],Communicator.Matrix.multiply(b,k[a]))}l++;l>=h&&clearInterval(u)},d)})}};e.prototype.translateAnimationWithLength=function(a,b,c,d,f){var g=this;if("object"!=typeof g.hwv||null==g.hwv||void 0==g.hwv)return-1;if("object"==typeof a&&null!=a&&void 0!=a&&"number"==typeof b&&null!=b&&void 0!=b&&!("number"!=typeof c||null==c||void 0==c||0>c||"number"!=typeof d||null==d||void 0==d||0>d||"object"!=typeof f||null==
f||void 0==f)){for(var e=[],h=0;h<a.length;h++){var k=g.getNodeIdFromGuid(a[h]);if(k>g.nodeCount||-1==k||void 0==k)return-1;e.push(k)}g.hwv.getModel().getNodesBounding(e).then(function(a){var l=0;a=b/c*d;for(var h=c/d,k=[],m=0;m<e.length;m++){var n=g._convertToLocalVector(e[m],f);k.push(new Communicator.Matrix);k[m].setTranslationComponent(n.x*a,n.y*a,n.z*a)}var u=setInterval(function(){for(var a=0;a<e.length;a++){var b=g.hwv.getModel().getNodeMatrix(e[a]);g.hwv.getModel().setNodeMatrix(e[a],Communicator.Matrix.multiply(b,
k[a]));g.hwv.getModel().setNodesTransparency([e[a]],.3)}l++;l>=h&&clearInterval(u)},d)})}};e.prototype.blinkColorAnimation=function(a,b,c,d,f){var e=this;if("object"!=typeof e.hwv||null==e.hwv||void 0==e.hwv)return-1;if("object"==typeof a&&null!=a&&void 0!=a&&!("number"!=typeof b||null==b||void 0==b||0>b||"number"!=typeof c||null==c||void 0==c||0>c||255<c||"number"!=typeof d||null==d||void 0==d||0>d||255<d||"number"!=typeof f||null==f||void 0==f||0>f||255<f)){for(var l=[],h=0;h<a.length;h++){var k=
e.getNodeIdFromGuid(a[h]);if(k>e.nodeCount||-1==k||void 0==k)return-1;l.push(k)}var m=0,k=setInterval(function(){0==m%2?(e.hwv.getModel().setNodesTransparency(l,.75),e.hwv.getModel().setNodesFaceColor(l,new Communicator.Color(c,d,f))):(e.hwv.getModel().resetNodesTransparency(l),e.hwv.getModel().unsetNodesFaceColor(l));m++;m>=b&&clearInterval(k)},400)}};e.prototype.blinkHighlightAnimation=function(a,b){var c=this;if("object"!=typeof c.hwv||null==c.hwv||void 0==c.hwv)return-1;if("object"==typeof a&&
null!=a&&void 0!=a&&!("number"!=typeof b||null==b||void 0==b||0>b)){for(var d=[],f=0;f<a.length;f++){var e=c.getNodeIdFromGuid(a[f]);if(e>c.nodeCount||-1==e||void 0==e)return-1;d.push(e)}var l=0,e=setInterval(function(){0==l%2?c.hwv.getModel().setNodesHighlighted(d,!0):c.hwv.getModel().setNodesHighlighted(d,!1);l++;l>=b&&clearInterval(e)},400)}};e.prototype.blinkTransparencyAnimation=function(a,b,c){var d=this;if("object"!=typeof d.hwv||null==d.hwv||void 0==d.hwv)return-1;if("object"==typeof a&&null!=
a&&void 0!=a&&!("number"!=typeof b||null==b||void 0==b||0>b)){for(var f=[],e=0;e<a.length;e++){var l=d.getNodeIdFromGuid(a[e]);if(l>d.nodeCount||-1==l||void 0==l)return-1;f.push(l)}var h=0,l=setInterval(function(){0==h%2?d.hwv.getModel().setNodesTransparency(f,b):d.hwv.getModel().setNodesTransparency(f,1);h++;h>=c&&clearInterval(l)},400)}};e.prototype.rotateAnimation=function(a,b,c,d,f,e){var g=this;if("object"!=typeof g.hwv||null==g.hwv||void 0==g.hwv)return-1;if("object"==typeof a&&null!=a&&void 0!=
a&&"object"==typeof b&&null!=b&&void 0!=b&&"object"==typeof c&&null!=c&&void 0!=c&&!("number"!=typeof d||null==d||void 0==d||0>d||"number"!=typeof f||null==f||void 0==f||"number"!=typeof e||null==e||void 0==e||0>e)){b=new Communicator.Point3(b.x,b.y,b.z);for(var h=[],k=0;k<a.length;k++){var m=g.getNodeIdFromGuid(a[k]);if(m>g.nodeCount||-1==m||void 0==m)return-1;h.push(m)}var q=0;a=f/d*e;for(var r=d/e,p=new Communicator.Matrix,t=[],n=[],k=0;k<h.length;k++)d=g._convertToLocalVector(h[k],b),t.push(new Communicator.Matrix.createFromOffAxisRotation(d,
a)),n.push(g._convertToLocalPoint(h[k],c));m=setInterval(function(){q++;for(var a=0;a<h.length;a++){var b=g._applyTransform(t[a],n[a]);p.setTranslationComponent(n[a].x-b.x,n[a].y-b.y,n[a].z-b.z);b=g.hwv.getModel().getNodeMatrix(h[a]);b=Communicator.Matrix.multiply(b,t[a]);g.hwv.getModel().setNodeMatrix(h[a],Communicator.Matrix.multiply(b,p))}q>=r&&clearInterval(m)},e)}};e.prototype.viewPointAnimation=function(a,b){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv||"object"!=typeof a||
null==a||""==a||void 0==a||"number"!=typeof b||null==b||""==b||void 0==b)return-1;var c=this.hwv.getView().getCamera();c.setPosition(a.pos);c.setProjection(a.projection);c.setTarget(a.tar);c.setHeight(a.height);c.setWidth(a.width);c.setNearLimit(a.nearLimit);c.setUp(a.up);this.hwv.getView().setCamera(c,b)};e.prototype.playAnimationWithGuid=function(a){var b=this;if("object"!=typeof b.hwv||null==b.hwv||void 0==b.hwv)return-1;"string"==typeof a&&null!=a&&void 0!=a&&(b.temp_guid=a,b.temp_time=2E3,b.temp_waitTime=
0,setTimeout(function(){b.blinkHighlightAnimation([b.temp_guid],6)},b.temp_waitTime),b.temp_waitTime+=2*b.temp_time,setTimeout(function(){b.translateAnimationWithEndPoint([b.temp_guid],{x:991022.625,y:-21422.4677734375,z:13712.0205078125},2E3,10,{x:.8355098323810358,y:-.5494754907268399,z:7.130997135220827E-5})},b.temp_waitTime),b.temp_waitTime+=b.temp_time,setTimeout(function(){b.translateAnimationWithLength([b.temp_guid],2E4,1E3,10,{x:.5494799021575423,y:.8355069342171481,z:0})},b.temp_waitTime))};
e.prototype.playAnimationWithGuids=function(a){var b=this;if("object"!=typeof b.hwv||null==b.hwv||void 0==b.hwv)return-1;"object"==typeof a&&null!=a&&void 0!=a&&(b.temp_guid=a,b.temp_time=2E3,b.temp_waitTime=0,setTimeout(function(){b.blinkHighlightAnimation(b.temp_guid,6)},b.temp_waitTime),b.temp_waitTime+=2*b.temp_time,setTimeout(function(){b.translateAnimationWithEndPoint(b.temp_guid,{x:991022.625,y:-21422.4677734375,z:13712.0205078125},2E3,10,{x:.8355098323810358,y:-.5494754907268399,z:7.130997135220827E-5})},
b.temp_waitTime),b.temp_waitTime+=b.temp_time,setTimeout(function(){b.translateAnimationWithLength(b.temp_guid,2E4,1E3,10,{x:.5494799021575423,y:.8355069342171481,z:0})},b.temp_waitTime))};e.prototype.playAnimationWithGuidAndWaittime=function(a,b){if("object"!=typeof this.hwv||null==this.hwv||void 0==this.hwv)return-1;"string"==typeof a&&null!=a&&void 0!=a&&setTimeout(function(){tk.playAnimationWithGuid(a)},b)};e.prototype.playAnimationWithGuidsAndWaittime=function(a,b){if("object"!=typeof this.hwv||
null==this.hwv||void 0==this.hwv)return-1;"object"==typeof a&&null!=a&&void 0!=a&&setTimeout(function(){tk.playAnimationWithGuids(a)},b)};e.prototype.playAnimationWithTween=function(a,b,c,d){function f(){requestAnimationFrame(f);TWEEN.update()}var e=this;if("object"!=typeof e.hwv||null==e.hwv||void 0==e.hwv)return-1;for(var l=[],h=0;h<a.length;h++){var k=e.getNodeIdFromGuid(a[h]);if(k>e.nodeCount||-1==k||void 0==k)return-1;l.push(k)}a={};a.length=b;var m=new TWEEN.Tween({length:0});m.to(a,c);m.onUpdate(function(){console.log(this._object.length);
for(var a=0;a<l.length;a++){var b=e._convertToLocalVector(l[a],d),c=new Communicator.Matrix;c.setTranslationComponent(b.x*this._object.length,b.y*this._object.length,b.z*this._object.length);e.hwv.getModel().setNodeMatrix(l[a],c)}2E4==this._object.length&&m.stop()});m.start();f()};e.prototype._gatherTCNodesForModelNodes=function(a){for(var b=[],c=a.length,d=0;d<c;++d){var f=this.hwv.getModel()._modelStructure.getGraphicsEngineIds(a[d],Communicator.Internal.GraphicsObjectTypeFlags.All);if(f)for(var e=
0;e<f.length;e++)b.push(f[e])}return b};e.prototype.setFaceMaterial=function(a,b){var c=this;if("object"!=typeof c.hwv||null==c.hwv||void 0==c.hwv||null==a||void 0==a||"string"!=typeof a||null==b||void 0==b||"string"!=typeof b)return-1;var d=c.getNodeIdFromGuid(a);if(-1!=d&&void 0!=d){var f=400,e=300,c=this,l=document.createElement("canvas"),h=l.getContext("2d"),k=new Image;k.src=b;k.onload=function(){f=k.width;e=k.height;l.width=f;l.height=e;h.fillStyle="white";h.fillRect(0,0,f,e);h.drawImage(k,
0,0,f,e);for(var a=h.getImageData(0,0,f,e).data,b=new ArrayBuffer(f*e*4),b=new Uint8Array(b),g=0;g<a.length;g++)b[g]=a[g];c.hwv.getModel()._graphicsEngine.createImage(Communicator.ImageFormat.RGBA32,f,e,b).then(function(a){var b=new Communicator.Color(0,0,0),d=new Communicator.Internal.TC.TextureInfo;d.imageId=a;d.matrixInc=c.hwv.getModel()._graphicsEngine.identityMatrixInc();d.tiling=0;d.interpolation=0;d.mipMapping=0;d.parameterization=0;d.modifiers=0;return c.hwv.getModel()._graphicsEngine.createTexturedMaterial(b,
1,d)}).then(function(a){var b=c._gatherTCNodesForModelNodes([d]);return 0<b.length?c.hwv.getModel()._graphicsEngine.setPartFaceMaterial(b,1,a):Promise.resolve(null)})}}};return e}();
(function(e){(function(a){var b=function(a){function b(c,d,l,h){var f=this;a.call(this);this._uniqueId=e.GUID.create();this._noteElementId=null;this._position=e.Point3.zero();this._selectionNormal=this._selectionPosition=null;this._src="";this._color=e.Color.white();this._partId=null;this._active=this._deleted=!1;b._noteTextList.push(this);b._activeItem=this;if(null==b._noteTextElement){var g=new e.Point2(12,-24);b._noteTextElement=new e.Markup.NoteImageElement(g)}this._viewer=c;this._selectionPosition=
d;this._selectionNormal=l;this._partId=h;null==b._globalPinSphereMeshId?this._createPinSphereMesh().then(function(a){b._globalPinSphereMeshId=a;f._createPinStemMesh().then(function(a){b._globalPinStemMeshId=a;f._init()})}):this._init();this._viewer.setCallbacks({partsVisibilityShown:function(){f._matchPartVisibility()},partsVisibilityHidden:function(){f._matchPartVisibility()}})}__extends(b,a);b.prototype._init=function(){var a=this,b=this._createPinTransformationMatrix(this._selectionPosition,this._selectionNormal),
c=this._createPinStemInstance(b),d=this._createPinSphereInstance(b);c.then(function(b){a._stemInstanceId=b;d.then(function(b){a._sphereInstanceId=b;a.restore()})})};b.prototype._matchPartVisibility=function(){var a=this._viewer.getModel().getNodeVisibility(this._partId),c=this._viewer.getModel().getNodeVisibility(this._sphereInstanceId);a!=c&&this._viewer.getModel().setNodesVisibility([this._stemInstanceId,this._sphereInstanceId],a);b._activeItem&&b._activeItem._stemInstanceId==this._stemInstanceId&&
!a&&this.hide()};b.prototype.updatePosition=function(){var a=this;return this._viewer.getModel().getNodeRealBounding(this._sphereInstanceId).then(function(b){a._pinBoundingBox=b;a._position=a._pinBoundingBox.center();a.setText(a._src)})};b.prototype.restore=function(){b._activeItemHandle=this._viewer.getMarkupManager().registerMarkup(this);b._activeItem=this;this._updateColor();this.draw();this.show()};b.prototype.setText=function(a){this._src=a;b._noteTextElement.setText(a)};b.prototype.saveTextValue=
function(){this._src=b._noteTextElement.getText()};b.prototype.draw=function(){var a=this;if(!this._deleted&&this._active){var c;this._behindView=!1;this.updatePosition().then(function(){c=a._viewer.getView().projectPoint(a._position);0>=c.z&&(a._behindView=!0);a._behindView?null!=document.getElementById(a._noteElementId)&&(a._viewer.getMarkupManager().removeMarkupElement(a._noteElementId),a._noteElementId=null):(b._noteTextElement.setPosition(c),null==a._noteElementId&&(a._noteElementId=a._viewer.getMarkupManager().addMarkupElement(b._noteTextElement.getTextArea())))})}};
b.prototype.hit=function(a){var c=b._noteTextElement.getPosition(),d=b._noteTextElement.getSize();return e.Internal.Utility.pointInRect(a,c,d)};b.prototype.getClassName=function(){return b.className};b.prototype.getSphereInstanceId=function(){return this._sphereInstanceId};b.prototype.getStemInstanceId=function(){return this._stemInstanceId};b.prototype.onSelect=function(){b._noteTextElement.focus()};b.prototype.onDeselect=function(){b._noteTextElement.blur()};b.prototype.hide=function(){b._noteTextElement.hide();
this.setText(b._noteTextElement.getText());b._activeItem=null;this._active=!1};b.prototype.show=function(){b._noteTextElement.show(this);this._active=!0};b.prototype.remove=function(){this._viewer.getModel().deleteMeshInstances([this._stemInstanceId]);this._viewer.getModel().deleteMeshInstances([this._sphereInstanceId]);this.hide();b._noteTextList.splice(b._noteTextList.indexOf(this),1);this._deleted=!0};b.prototype.getRemoved=function(){return this._deleted};b.prototype.setColor=function(a){this._color=
a;this._updateColor()};b.prototype.getColor=function(){return this._color};b.prototype.getPartId=function(){return this._partId};b.prototype._updateColor=function(){this._viewer.getModel().setNodesFaceColor([this._sphereInstanceId],this._color)};b.prototype._setAllPinVisibility=function(){for(var a=[],c=0;c<b._noteTextList.length;c++)a.push(b._noteTextList[c]._sphereInstanceId),a.push(b._noteTextList[c]._stemInstanceId);c=!b._explodeActive;this._viewer.getModel().setNodesVisibility(a,c);c||b._noteTextElement.hide()};
b.updatePinVisibility=function(){0<b._noteTextList.length&&b._noteTextList[0]._setAllPinVisibility()};b.explodeBegin=function(){b._explodeActive=!0;b.updatePinVisibility()};b.explodeEnd=function(){b._explodeActive=!1;b.updatePinVisibility()};b.getExplodeActive=function(){return b._explodeActive};b.checkCuttingActive=function(){b._cuttingActive=!1;if(0<b._noteTextList.length)for(var a=b._noteTextList[0]._viewer.getCuttingManager(),c=0;c<a.getCuttingSectionCount();c++)if(a.getCuttingSection(c).isActive()){b._cuttingActive=
!0;break}b.updatePinVisibility()};b.getCuttingActive=function(){return b._cuttingActive};b.setIsolateActive=function(a){b._isolateActive=a};b.getIsolateActive=function(){return b._isolateActive};b.getActiveItem=function(){return this._activeItem};b.getItemList=function(){return this._noteTextList};b.checkForSelectedPin=function(a,c){this._activeItem&&this._activeItem.hide();for(a=0;a<b._noteTextList.length;a++)if(this._noteTextList[a].getSphereInstanceId()==c.getNodeId()||this._noteTextList[a].getStemInstanceId()==
c.getNodeId())return this._noteTextList[a].restore(),!0;return!1};b.checkForContextSelection=function(a){for(var c=0;c<b._noteTextList.length;c++)if(this._noteTextList[c].getSphereInstanceId()==a||this._noteTextList[c].getStemInstanceId()==a)return!0;return!1};b.prototype._createPinTransformationMatrix=function(a,c){var d=0,f=c.x;Math.abs(c.y)<Math.abs(f)&&(f=c.y,d=1);Math.abs(c.z)<Math.abs(f)&&(d=2);f=[0,0,0];f[d]=1;var d=e.Point3.createFromArray(f),d=e.Point3.cross(c,d).normalize(),f=e.Point3.cross(c,
d),g=new e.Matrix;g.m=[c.x,c.y,c.z,0,d.x,d.y,d.z,0,f.x,f.y,f.z,0,0,0,0,1];g=e.Matrix.multiply(g,(new e.Matrix).setScaleComponent(b._sphereRadius,b._sphereRadius,b._sphereRadius));g.setTranslationComponent(a.x,a.y,a.z);return g};b.prototype._createPinStemInstance=function(a){var c=this;a=new e.MeshInstanceData(b._globalPinStemMeshId,a,"pin-stem-instance",null,e.Color.black());a.setTransparency(1);return this._viewer.getModel().createMeshInstance(a,null,!0).then(function(a){c._viewer.getModel().setInstanceModifier(e.InstanceModifier.IgnoreCameraScale,
[a],!0);c._viewer.getModel().setInstanceModifier(e.InstanceModifier.IgnoreCutting,[a],!1);c._viewer.getModel().setInstanceModifier(e.InstanceModifier.IgnoreExplosion,[a],!0);c._viewer.getModel().setInstanceModifier(e.InstanceModifier.OverrideSceneVisibility,[a],!0);c._viewer.getModel().setInstanceModifier(e.InstanceModifier.AlwaysDraw,[a],!0);return a})};b.prototype._createPinSphereInstance=function(a){var c=this;a=new e.MeshInstanceData(b._globalPinSphereMeshId,a,"pin-sphere-instance",e.Color.white(),
null);a.setTransparency(1);return this._viewer.getModel().createMeshInstance(a,null,!0).then(function(a){c._viewer.getModel().setInstanceModifier(e.InstanceModifier.IgnoreCameraScale,[a],!0);c._viewer.getModel().setInstanceModifier(e.InstanceModifier.IgnoreCutting,[a],!1);c._viewer.getModel().setInstanceModifier(e.InstanceModifier.IgnoreExplosion,[a],!0);c._viewer.getModel().setInstanceModifier(e.InstanceModifier.OverrideSceneVisibility,[a],!0);c._viewer.getModel().setInstanceModifier(e.InstanceModifier.AlwaysDraw,
[a],!0);return a})};b.prototype._createPinStemMesh=function(){var a=new e.MeshData;a.addPolyline([0,0,0,b._stemLength,0,0]);return this._viewer.getModel().createMesh(a).then(function(a){return a})};b.prototype._createPinSphereMesh=function(){var a=(1+Math.sqrt(5))/2,c=Math.sqrt(10+2*Math.sqrt(5))/(4*a),d=c/2,a=c/(2*a),h=[];h[0]=new e.Point3(-a,d,0);h[1]=new e.Point3(a,d,0);h[2]=new e.Point3(-a,-d,0);h[3]=new e.Point3(a,-d,0);h[4]=new e.Point3(0,-a,d);h[5]=new e.Point3(0,a,d);h[6]=new e.Point3(0,-a,
-d);h[7]=new e.Point3(0,a,-d);h[8]=new e.Point3(d,0,-a);h[9]=new e.Point3(d,0,a);h[10]=new e.Point3(-d,0,-a);h[11]=new e.Point3(-d,0,a);for(c=0;c<h.length;c++)h[c].normalize();for(var k=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],m=12,c=0;c<b._sphereIterations;c++){var q=[];k.map(function(a){var b=h[a[0]],c=h[a[1]],d=h[a[2]];h[m++]=(new e.Point3(b.x+c.x,b.y+c.y,b.z+c.z)).scale(.5).normalize();
h[m++]=(new e.Point3(c.x+d.x,c.y+d.y,c.z+d.z)).scale(.5).normalize();h[m++]=(new e.Point3(d.x+b.x,d.y+b.y,d.z+b.z)).scale(.5).normalize();q.push([a[0],m-3,m-1]);q.push([m-3,m-2,m-1]);q.push([m-3,a[1],m-2]);q.push([m-2,a[2],m-1])});k=q}d=[];a=[];for(c=0;c<k.length;c++)for(var r=0;3>r;r++){var p=k[c][r];d.push(h[p].x+b._stemLength+1);d.push(h[p].y);d.push(h[p].z);p=h[p].normalize();a.push(p.x);a.push(p.y);a.push(p.z)}c=new e.MeshData;c.addFaces(d,a);c.setFaceWinding(e.FaceWinding.CounterClockwise);
return this._viewer.getModel().createMesh(c).then(function(a){return a})};b.prototype.forJson=function(){return{uniqueId:this._uniqueId,className:this.getClassName(),selectionPosition:this._selectionPosition.forJson(),selectionNormal:this._selectionNormal.forJson(),text:this._src,color:this._color,partId:this._partId}};b.construct=function(a,c){if(!b.findById(a.uniqueId)){var d=new e.Point3(a.selectionPosition.x,a.selectionPosition.y,a.selectionPosition.z),f=new e.Point3(a.selectionNormal.x,a.selectionNormal.y,
a.selectionNormal.z);c=new b(c,d,f,a.partId);c._uniqueId=a.uniqueId;c.setText(a.text);c.setColor(new e.Color(a.color.r,a.color.g,a.color.b));return c}return null};b.findById=function(a){for(var c=0;c<b._noteTextList.length;c++)if(a==b._noteTextList[c]._uniqueId)return!0;return!1};b.className="Communicator.Markup.NoteText";b._noteTextElement=null;b._noteTextList=[];b._globalPinSphereMeshId=null;b._globalPinStemMeshId=null;b._activeItemHandle=null;b._activeItem=null;b._explodeActive=!1;b._cuttingActive=
!1;b._isolateActive=!1;b._stemLength=2;b._sphereRadius=.03;b._sphereIterations=2;return b}(a.MarkupItem);a.ImgMarkup=b})(e.Markup||(e.Markup={}))})(Communicator||(Communicator={}));
(function(e){(function(a){var b=function(){function a(a){this._cornerOffset=e.Point2.zero();this._activeNoteText=null;this._createTextBox();this._cornerOffset=a}a.prototype._createTextBox=function(){var a=this;this._textContainer=document.createElement("div");this._textContainer.className="noteTextElement";this._textArea=document.createElement("img");this._textArea.oninput=function(){a._activeNoteText.saveTextValue()};this._textContainer.appendChild(this._textArea);var b=7;["blue","red","green","white",
"black"].map(function(c){var d=document.createElement("button");d.className="noteButton color "+c;d.style.top=b+"px";b+=25;d.id=c+"_button";var f;switch(c){case "blue":f=e.Color.blue();break;case "red":f=e.Color.red();break;case "green":f=e.Color.green();break;case "white":f=e.Color.white();break;case "black":f=e.Color.black();break;default:f=e.Color.white()}d.onmousedown=function(b){a._activeNoteText.setColor(f)};a._textContainer.appendChild(d)});var c=document.createElement("button");c.className=
"noteButton trash";c.style.top=b+"px";c.onmousedown=function(b){a._activeNoteText.remove()};this._textContainer.appendChild(c)};a.prototype.setPosition=function(a){var b=a.x+this._cornerOffset.x;this._textContainer.style.top=a.y+this._cornerOffset.y+"px";this._textContainer.style.left=b+"px"};a.prototype.getPosition=function(){return new e.Point2(parseFloat(this._textContainer.style.left),parseFloat(this._textContainer.style.top))};a.prototype.setBorderWidth=function(a){};a.prototype.setText=function(a){var b=
this._textContainer.querySelector("img");b.src=a;b.onload=function(){var a=b.width;b.margin=5;b.width=200;b.height=200/a*142}};a.prototype.getText=function(){return this._textContainer.querySelector("img").src};a.prototype.setSize=function(a){this._textContainer.style.width=a.x+"px";this._textContainer.style.height=a.y+"px"};a.prototype.getSize=function(){var a=this._textContainer.getBoundingClientRect();return new e.Point2(a.width,a.height)};a.prototype.focus=function(){this._textArea.focus();this._textArea.style.pointerEvents=
"auto"};a.prototype.blur=function(){this._textContainer.blur()};a.prototype.hide=function(){this._textContainer.style.visibility="hidden";this._activeNoteText=null};a.prototype.show=function(a){this._textContainer.style.visibility="visible";this._activeNoteText=a};a.prototype.getTextArea=function(){return this._textContainer};return a}();a.NoteImageElement=b})(e.Markup||(e.Markup={}))})(Communicator||(Communicator={}));
(function(e){(function(a){var b=function(a){function b(b,c,d,h){a.call(this);this._leaderLine=new e.Markup.Shape.Line;this._text1=new e.Markup.Shape.Text;this._frame=new e.Markup.Shape.Rectangle;this._frame.setFillOpacity(.4);this._frame.setFillColor(new e.Color(200,200,200));this._frame.setStrokeColor(new e.Color(20,20,20));this._viewer=b;this._leaderAnchor=c.copy();this._textBoxAnchor=h.copy();this._text1.setText(d);this._leaderLine.setStartEndcapType(e.Markup.Shape.EndcapType.Arrowhead);this._leaderLine.setStartEndcapColor(new e.Color(125,
125,125));this._leaderLine.setStrokeColor(new e.Color(125,125,125));this.setValues()}__extends(b,a);b.prototype.draw=function(){this._behindView=!1;var a=this._viewer.getView().projectPoint(this._leaderAnchor),b=this._viewer.getView().projectPoint(this._textBoxAnchor);0>=a.z&&(this._behindView=!0);0>=b.z&&(this._behindView=!0);var a=e.Point2.fromPoint3(a),b=e.Point2.fromPoint3(b),c=this._frame.getSize(),d=b.copy();b.x+c.x/2<a.x&&(d.x+=c.x);b.y-c.y/2<a.y&&(d.y+=c.y);this._leaderLine.set(a,d);a=b.copy();
a.x+=1;a.y+=1;this._text1.setPosition(a);this._frame.setPosition(b);a=this._viewer.getMarkupManager().getRenderer();a.drawLine(this._leaderLine);a.drawText(this._text1)};b.prototype.setColor=function(a,b,c){this._frame.setFillOpacity(.4);this._frame.setFillColor(new e.Color(200,200,200));this._leaderLine.setStartEndcapColor(new e.Color(a,b,c));this._leaderLine.setStrokeColor(new e.Color(a,b,c))};b.prototype.hit=function(a){console.log("ssss");var b=this._frame.getSize(),c=this._text1.getPosition();
return a.x<c.x||a.x>c.x+b.x||a.y<c.y||a.y>c.y+b.y?!1:!0};b.prototype.getLeaderLineAnchor=function(){return this._leaderAnchor.copy()};b.prototype.getTextBoxAnchor=function(){return this._textBoxAnchor};b.prototype.setTextBoxAnchor=function(a){this._textBoxAnchor.assign(a)};b.prototype.getLabel=function(){return this._text1.getText()};b.prototype.setLabel=function(a){this._text1.setText(a)};b.prototype.selialize=function(){return{label:this.getLabel(),leaderAnchor:this._leaderAnchor.forJson(),textBoxAnchor:this._textBoxAnchor.forJson()}};
b.prototype.setValues=function(){var a=this._viewer.getMarkupManager().getRenderer().measureText(this._text1.getText(),this._text1);this._frame.setSize(new e.Point2(a.x+4,a.y+6))};return b}(a.MarkupItem);a.AnnotationMarkup=b})(e.Markup||(e.Markup={}))})(Communicator||(Communicator={}));