var __extends=this&&this.__extends||function(d,e){function g(){this.constructor=d}for(var c in e)e.hasOwnProperty(c)&&(d[c]=e[c]);d.prototype=null===e?Object.create(e):(g.prototype=e.prototype,new g)},Communicator;
(function(d){(function(e){(function(e){var c=function(){function a(a,b){this.action=a;this.element=b}a.prototype.setEnabled=function(a){a?$(this.element).removeClass("disabled"):$(this.element).addClass("disabled")};a.prototype.setText=function(a){this.element.innerHTML=a};a.prototype.show=function(){$(this.element).show()};a.prototype.hide=function(){$(this.element).hide()};return a}();e.ContextMenuItem=c;var a=function(){function a(a,b,c,d){var f=this;this._contextItems={};this._activeItemId=null;
this._separatorCount=0;this._position=null;this._viewer=c;this._containerId=b;this._isolateZoomHelper=d;this._transparencyIdHash=[];this._initElements(a);this._viewer.setCallbacks({modelStructureReady:function(){f._onModelStructureReady()}})}a.prototype._onModelStructureReady=function(){this._viewer.getModel().isDrawing()&&(this._contextItems.hasOwnProperty("reset")&&this._contextItems.reset.hide(),$(".contextmenu-separator-3").hide())};a.prototype._isMenuItemEnabled=function(){if(null!=this._activeItemId&&
!d.Markup.NoteText.checkForContextSelection(this._activeItemId))return!0;for(var a=this._viewer.getSelectionManager().getResults(),b=a.length,c=0;c<b;++c)if(1!=a[c].overlayIndex())return!0;return!1};a.prototype.setActiveItemId=function(a){this._activeItemId=a;this._isMenuItemEnabled()?(this._contextItems[this._containerId+"visibility"].setText(this._isVisible(a)?"\u9690\u85cf":"\u663e\u793a"),this._contextItems[this._containerId+"isolate"].setEnabled(!0),this._contextItems[this._containerId+"zoom"].setEnabled(!0),
this._contextItems[this._containerId+"visibility"].setEnabled(!0),this._contextItems[this._containerId+"transparent"].setText(this._isTransparency(a)?"\u4e0d\u900f\u660e":"\u900f\u660e"),this._contextItems[this._containerId+"transparent"].setEnabled(!0),(a=this._viewer.getOperatorManager().getOperator(d.OperatorId.Handle))&&a.isEnabled?this._contextItems[this._containerId+"handles"].setEnabled(0<this.getContextItemIds(!0,!0,!1).length&&a.isEnabled()):this._contextItems[this._containerId+"handles"].setEnabled(!1)):
(this._contextItems[this._containerId+"isolate"].setEnabled(!1),this._contextItems[this._containerId+"zoom"].setEnabled(!1),this._contextItems[this._containerId+"visibility"].setEnabled(!1),this._contextItems[this._containerId+"transparent"].setEnabled(!1),this._contextItems[this._containerId+"handles"].setEnabled(!1))};a.prototype.showElements=function(a){this._viewer.setContextMenuStatus(!0);var f=this._viewer.getView().getCanvasSize(),b=$(this._menuElement);b.height()>f.y&&b.addClass("small");
var c=b.outerWidth(),b=b.outerHeight(),d=a.y;a=a.x;d+b>f.y&&(d=f.y-b-1);a+c>f.x&&(a=f.x-c-1);$(this._menuElement).css({top:d+"px",left:a+"px",display:"block"});$(this._menuElement).show();$(this._contextLayer).show()};a.prototype._onContextLayerClick=function(a){0==a.button&&this.hide()};a.prototype.hide=function(){this._viewer.setContextMenuStatus(!1);$(this._menuElement).hide();$(this._contextLayer).hide();$(this._menuElement).removeClass("small")};a.prototype._doMenuClick=function(a){$(a.target).hasClass("disabled")||
(a=$(a.target).attr("id"),a=this._contextItems[a],null!=a&&a.action(this._activeItemId),this.hide())};a.prototype._getSelectedPartIds=function(){var a=[];this._viewer.getSelectionManager().each(function(b){a.push(b.getNodeId())});return a};a.prototype._initElements=function(a){var b=this;this._menuElement=document.createElement("div");this._menuElement.oncontextmenu=function(){return!1};this._menuElement.classList.add("ui-contextmenu");null!=a&&this._menuElement.classList.add(a);this._menuElement.style.position=
"absolute";this._menuElement.style.zIndex="10001";this._menuElement.style.display="none";this._menuElement.ontouchmove=function(a){a.preventDefault()};this._contextLayer=document.createElement("div");this._contextLayer.style.position="relative";this._contextLayer.style.width="100%";this._contextLayer.style.height="100%";this._contextLayer.style.backgroundColor="transparent";this._contextLayer.style.zIndex="10000";this._contextLayer.style.display="none";this._contextLayer.oncontextmenu=function(){return!1};
this._contextLayer.ontouchmove=function(a){a.preventDefault()};this._createDefaultMenuItems();a=document.getElementById(this._containerId);a.appendChild(this._menuElement);a.appendChild(this._contextLayer);$(this._menuElement).on("click",".ui-contextmenu-item",function(a){b._doMenuClick(a)});$(this._contextLayer).bind("mousedown",function(a){b._onContextLayerClick(a)})};a.prototype._isMenuItemExecutable=function(){return null!=this._activeItemId||0<this._viewer.getSelectionManager().getResults().length};
a.prototype._createDefaultMenuItems=function(){var a=this;this.appendItem(a._containerId+"isolate","\u9694\u79bb\u5c45\u4e2d",function(){a._isMenuItemExecutable()&&a._isolateZoomHelper.isolateNodes(a.getContextItemIds(!0,!0))});this.appendItem(a._containerId+"zoom","\u653e\u5927\u5c45\u4e2d",function(){a._isMenuItemExecutable()&&a._isolateZoomHelper.fitNodes(a.getContextItemIds(!0,!0))});this.appendItem(a._containerId+"visibility","\u9690\u85cf",function(){a._isMenuItemExecutable()&&a._viewer.getModel().setNodesVisibility(a.getContextItemIds(!0,
!0),!a._isVisible(a._activeItemId))});this.appendseparator();this.appendItem(a._containerId+"transparent","\u900f\u660e",function(){if(a._isMenuItemExecutable()){var b=a._viewer.getModel(),f=a.getContextItemIds(!0,!0);if(void 0==a._transparencyIdHash[f[0]]){for(var c=0;c<f.length;c++)a._transparencyIdHash[f[c]]=1;b.setNodesTransparency(f,.5)}else{for(c=0;c<f.length;c++)a._transparencyIdHash[f[c]]=void 0;b.resetNodesTransparency(f)}}});this.appendseparator();this.appendItem(a._containerId+"handles",
"\u663e\u793a\u64cd\u4f5c\u9762\u677f",function(){if(a._isMenuItemExecutable()){var b=a._viewer.getOperatorManager().getOperator(d.OperatorId.Handle),f=a.getContextItemIds(!0,!0,!1);0<f.length&&b.addHandles(f,a._position)}});this.appendItem(a._containerId+"reset","\u91cd\u7f6e\u6a21\u578b",function(){a._viewer.getModel().reset();a._viewer.getOperatorManager().getOperator(d.OperatorId.Handle).removeHandles()});this._viewer.getCreationParameters().hasOwnProperty("model")&&this.appendseparator();this.appendseparator();
this.appendItem(a._containerId+"showall","\u663e\u793a\u6240\u6709",function(){a._isolateZoomHelper.showAll()})};a.prototype.getContextItemIds=function(a,b,c){void 0===c&&(c=!0);var f=this._viewer.getModel().getRootNode(),h=[];if(a){a=this._viewer.getSelectionManager().getResults();for(var k=0;k<a.length;k++){var e=a[k].getNodeId();null!=e&&(c||!c&&e!=f)&&h.push(e)}}a=null!=this._viewer.getSelectionManager().containsParent(new d.Selection.SelectionItem(this._activeItemId));k=-1!=h.indexOf(this._activeItemId);
!b||null==this._activeItemId||!c&&(c||this._activeItemId==f||0!=h.length&&(k||a))||h.push(this._activeItemId);return h};a.prototype.appendItem=function(a,b,d){var f=document.createElement("div");f.classList.add("ui-contextmenu-item");f.innerHTML=b;f.id=a;this._menuElement.appendChild(f);b=new c(d,f);return this._contextItems[a]=b};a.prototype.appendseparator=function(){var a=document.createElement("div");a.classList.add("contextmenu-separator-"+this._separatorCount++);a.classList.add("ui-contextmenu-separator");
a.style.width="100%";a.style.height="1px";this._menuElement.appendChild(a)};a.prototype._appendMenuItem=function(a,b){var f=document.createElement("div");f.classList.add("ui-contextmenu-item");f.innerHTML=a;b.appendChild(f);return f};a.prototype._appendseparator=function(a){var b=document.createElement("div");b.classList.add("ui-contextmenu-separator");b.style.width="100%";b.style.height="1px";a.appendChild(b)};a.prototype._isVisible=function(a){a=this._viewer.getSelectionManager().getResults();return null!=
this._activeItemId?this._viewer.getModel().getNodeVisibility(this._activeItemId):this._viewer.getModel().getNodeVisibility(a[0].getNodeId())};a.prototype._isTransparency=function(a){if(void 0!=a||null!=a)return 1==this._transparencyIdHash[a]?!0:!1};return a}();e.ContextMenu=a})(e.Context||(e.Context={}))})(d.Ui||(d.Ui={}))})(Communicator||(Communicator={}));
(function(d){(function(e){(function(a){a[a.Hidden=0]="Hidden";a[a.Visible=1]="Visible";a[a.Inverted=2]="Inverted"})(e.Status||(e.Status={}));var g=e.Status;(function(a){a[a.X=0]="X";a[a.Y=1]="Y";a[a.Z=2]="Z";a[a.FACE=3]="FACE"})(e.AxisIndex||(e.AxisIndex={}));var c=e.AxisIndex,a=function(){function a(a){var b=this;this._cuttingSections=[];this._cuttingPlanes=[];this._referenceGeometry=[];this._status=[];this._cadViewActivated=!1;this._useIndividualCuttingSections=this._showReferenceGeometry=!0;this._boundingBoxUpdate=
!1;this._updateReferenceGeometry=[];this._faceSelection=null;this._pendingFuncs={visibility:null,inverted:null};this._viewer=a;this.resetCuttingPlanes();this._viewer.setCallbacks({modelStructureReady:function(){b._initSection()},partsVisibilityHidden:function(){b._boundingBoxUpdate||b._updateBoundingBox()},partsVisibilityShown:function(){b._boundingBoxUpdate||b._updateBoundingBox()},hwfParseComplete:function(){b._boundingBoxUpdate||b._updateBoundingBox()},modelSwitched:function(){b._boundingBoxUpdate||
b._updateBoundingBox();b.resetCuttingPlanes()}})}a.prototype._setStatus=function(a,b){this._status[a]=b};a.prototype._updateBoundingBox=function(){var a=this;this._boundingBoxUpdate=!0;return this._viewer.getModel().getModelBounding(!0,!1).then(function(b){var f=a._modelBounding.min.equalsWithTolerance(b.min,.01),h=a._modelBounding.max.equalsWithTolerance(b.max,.01);if(f&&h)Promise.resolve(null);else{a._modelBounding=b;a._updateReferenceGeometry[c.X]=!0;a._updateReferenceGeometry[c.Y]=!0;a._updateReferenceGeometry[c.Z]=
!0;a._updateReferenceGeometry[c.FACE]=!0;var d=[a._isActive(c.X),a._isActive(c.Y),a._isActive(c.Z),a._isActive(c.FACE)];a._storePlanes();a._clearCuttingSections().then(function(){return a._restorePlanes(d)})}a._boundingBoxUpdate=!1})};a.prototype._resetAxis=function(a){this._cuttingPlanes[a]=null;this._referenceGeometry[a]=null;this._setStatus(a,g.Hidden);this._updateReferenceGeometry[a]=!1;a==c.FACE&&(this._faceSelection=null)};a.prototype.resetCuttingPlanes=function(){this._resetAxis(c.X);this._resetAxis(c.Y);
this._resetAxis(c.Z);this._resetAxis(c.FACE);this._showReferenceGeometry=this._useIndividualCuttingSections=!0;this._faceSelection=null;this._clearCuttingSections()};a.prototype._initSection=function(){var a=this;this._viewer.getModel().getModelBounding(!0,!1).then(function(b){a._modelBounding=b.copy();a._cuttingSections[c.X]=a._viewer.getCuttingManager().getCuttingSection(c.X);a._cuttingSections[c.Y]=a._viewer.getCuttingManager().getCuttingSection(c.Y);a._cuttingSections[c.Z]=a._viewer.getCuttingManager().getCuttingSection(c.Z);
a._cuttingSections[c.FACE]=a._viewer.getCuttingManager().getCuttingSection(c.FACE);a._triggerPendingFuncs()})};a.prototype._triggerPendingFuncs=function(){this._pendingFuncs.inverted&&(this._pendingFuncs.inverted(),this._pendingFuncs.inverted=null);this._pendingFuncs.visibility&&(this._pendingFuncs.visibility(),this._pendingFuncs.visibility=null)};a.prototype.toggle=function(a){a=this._getAxis(a);var b=!1;if(a==c.FACE){var f=this._viewer.getSelectionManager().getLast();if(b=null!=f&&null!=f.getFaceEntity())this._faceSelection=
f}switch(this._status[a]){case g.Hidden:a==c.FACE?b&&(this._cuttingSections[a].clear(),this._cadViewActivated=!1,this._setStatus(a,g.Visible),this.setCuttingPlaneVisibility(!0,a)):(this._setStatus(a,g.Visible),this.setCuttingPlaneVisibility(!0,a));break;case g.Visible:this._setStatus(a,g.Inverted);this.setCuttingPlaneInverted(a);break;case g.Inverted:this._setStatus(a,g.Hidden),this.setCuttingPlaneVisibility(!1,a)}};a.prototype.getCount=function(){for(var a=0,b=0;b<this._cuttingSections.length;b++)a+=
this._cuttingSections[b].getCount();return a};a.prototype.setCuttingPlaneVisibility=function(a,b){var f=this;if(this._cuttingSections[this._getCuttingSectionIndex(b)]){this._viewer.delayCapping();a?(null==this._cuttingPlanes[b]&&(this._cuttingPlanes[b]=this._generateCuttingPlane(b),this._referenceGeometry[b]=this._generateReferenceGeometry(b)),this._setSection(b)):this.refreshPlaneGeometry();var h=this.getCount(),c=this._isActive(b);0<h&&!c?this._activatePlanes():c&&0==h&&this._deactivateAxis(b)}else this._pendingFuncs.visibility=
function(){f.setCuttingPlaneVisibility(a,b)}};a.prototype.setCuttingPlaneInverted=function(a){var b=this;if(this._cuttingSections[this._getCuttingSectionIndex(a)]){this._viewer.delayCapping();var f=this._getPlaneIndex(a),c=this._cuttingSections[this._getCuttingSectionIndex(a)].getPlane(f);c&&(c.normal.negate(),c.d*=-1,this._cuttingSections[this._getCuttingSectionIndex(a)].updatePlane(f,c))}else this._pendingFuncs.inverted=function(){b.setCuttingPlaneInverted(a)}};a.prototype.toggleReferenceGeometry=
function(){this._showReferenceGeometry=!this._showReferenceGeometry;this.refreshPlaneGeometry()};a.prototype.refreshPlaneGeometry=function(){this._storePlanes();this._clearCuttingSections();this._restorePlanes()};a.prototype.toggleCuttingMode=function(){this._storePlanes();this._clearCuttingSections();this._useIndividualCuttingSections=!this._useIndividualCuttingSections;this._restorePlanes()};a.prototype.cadViewActivated=function(){this._cadViewActivated=!0;this._setStatus(c.FACE,g.Hidden)};a.prototype._isActive=
function(a){return this._cuttingSections[this._getCuttingSectionIndex(a)].isActive()};a.prototype._activateAxis=function(a){this._cuttingSections[this._getCuttingSectionIndex(a)].activate()};a.prototype._deactivateAxis=function(a){this._cuttingSections[this._getCuttingSectionIndex(a)].deactivate()};a.prototype._getCuttingSectionIndex=function(a){return this._useIndividualCuttingSections?a:0};a.prototype._clearCuttingSection=function(a){return this._cuttingSections[a]?this._cuttingSections[a].clear():
Promise.resolve(null)};a.prototype._clearCuttingSections=function(){var a=[];a.push(this._clearCuttingSection(c.X));a.push(this._clearCuttingSection(c.Y));a.push(this._clearCuttingSection(c.Z));this._cadViewActivated||a.push(this._clearCuttingSection(c.FACE));return Promise.all(a)};a.prototype._activatePlane=function(a){a=this._cuttingSections[a];return a.getCount()?(a=a.activate(),null===a?Promise.resolve(null):a):Promise.resolve(null)};a.prototype._activatePlanes=function(a){var b=[];a&&!a[0]||
b.push(this._activatePlane(c.X));a&&!a[1]||b.push(this._activatePlane(c.Y));a&&!a[2]||b.push(this._activatePlane(c.Z));a&&!a[3]||b.push(this._activatePlane(c.FACE));return Promise.all(b)};a.prototype._getAxis=function(a){switch(a){case "x":return c.X;case "y":return c.Y;case "z":return c.Z;case "face":return c.FACE;default:return null}};a.prototype._getPlaneIndex=function(a){var b;if(this._useIndividualCuttingSections){if(this._cuttingSections[this._getCuttingSectionIndex(a)].getPlane(0))return 0}else for(var f=
0;f<this._cuttingSections[0].getCount();f++){b=this._cuttingSections[0].getPlane(f);var d=null;this._faceSelection&&this._faceSelection.getFaceEntity()&&(d=this._faceSelection.getFaceEntity().getNormal());if(b&&(b.normal.x&&a==c.X||b.normal.y&&a==c.Y||b.normal.z&&a==c.Z||a==c.FACE&&d&&b.normal.equals(d)))return f}return-1};a.prototype._setSection=function(a){null!=this._cuttingPlanes[a]&&this._cuttingSections[this._getCuttingSectionIndex(a)].addPlane(this._cuttingPlanes[a],this._showReferenceGeometry?
this._referenceGeometry[a]:null)};a.prototype._restorePlane=function(a){if(null!=this._cuttingPlanes[a]&&this._status[a]!=g.Hidden){if(!this._referenceGeometry[a]||this._updateReferenceGeometry[a])this._referenceGeometry[a]=this._generateReferenceGeometry(a);this._setSection(a)}};a.prototype._restorePlanes=function(a){this._restorePlane(c.X);this._restorePlane(c.Y);this._restorePlane(c.Z);this._restorePlane(c.FACE);return this._activatePlanes(a)};a.prototype._storePlane=function(a){var b=this._cuttingSections[this._getCuttingSectionIndex(a)];
this._cuttingPlanes[a]=null;this._referenceGeometry[a]=null;if(0<b.getCount()&&this._status[a]!=g.Hidden){var f=this._getPlaneIndex(a),d=b.getPlane(f),b=b.getReferenceGeometry(f);this._cadViewActivated&&a==c.FACE||(this._cuttingPlanes[a]=d,b&&(this._referenceGeometry[a]=b))}};a.prototype._storePlanes=function(){this._storePlane(c.X);this._storePlane(c.Y);this._storePlane(c.Z);this._storePlane(c.FACE)};a.prototype._generateReferenceGeometry=function(a){var b=[],f;if(a==c.FACE)this._faceSelection&&
this._faceSelection.getFaceEntity()&&(a=this._faceSelection.getFaceEntity().getNormal(),b=this._faceSelection.getPosition(),b=this._viewer.getCuttingManager().createReferenceGeometryFromFaceNormal(a,b,this._modelBounding));else{switch(a){case c.X:f=d.Axis.X;break;case c.Y:f=d.Axis.Y;break;case c.Z:f=d.Axis.Z}b=this._viewer.getCuttingManager().createReferenceGeometryFromAxis(f,this._modelBounding)}return b};a.prototype._generateCuttingPlane=function(a){var b=new d.Plane;switch(a){case c.X:b.normal.set(1,
0,0);b.d=-this._modelBounding.max.x;break;case c.Y:b.normal.set(0,1,0);b.d=-this._modelBounding.max.y;break;case c.Z:b.normal.set(0,0,1);b.d=-this._modelBounding.max.z;break;case c.FACE:if(this._faceSelection&&this._faceSelection.getFaceEntity()){this._faceSelection=this._faceSelection;a=this._faceSelection.getFaceEntity().getNormal();var f=this._faceSelection.getPosition();b.setFromPointAndNormal(f,a)}else return null}return b};return a}();e.CuttingPlaneController=a})(d.Ui||(d.Ui={}))})(Communicator||
(Communicator={}));
(function(d){var e=function(){function e(c){this._viewer=c;this._camera=null;this._cameraSet=!1;this._deselectOnZoom=this._deselectOnIsolate=!0;this._isolateStatus=!1}e.prototype._setCamera=function(c){this._cameraSet||(this._camera=c,this._cameraSet=!0)};e.prototype._getCamera=function(){this._cameraSet=!1;return this._camera};e.prototype.setDeselectOnIsolate=function(c){this._deselectOnIsolate=c};e.prototype.getIsolateStatus=function(){return this._isolateStatus};e.prototype.isolateNodes=function(c){this._setCamera(this._viewer.getView().getCamera());
this._viewer.getView().isolateNodes(c);this._deselectOnIsolate&&this._viewer.getSelectionManager().clear();this._isolateStatus=!0};e.prototype.fitNodes=function(c){this._setCamera(this._viewer.getView().getCamera());this._viewer.getView().fitNodes(c);this._deselectOnZoom&&this._viewer.getSelectionManager().clear()};e.prototype.showAll=function(){if(this._viewer.getModel().isDrawing()){var c=this._viewer.getActiveSheetId();null!==c&&this.isolateNodes([c])}else this._viewer.getModel().resetNodesVisibility(),
this._cameraSet&&this._viewer.getView().setCamera(this._getCamera(),400),this._isolateStatus=!1,this._updatePinVisibility()};e.prototype._updatePinVisibility=function(){d.Markup.NoteText.setIsolateActive(this._isolateStatus);d.Markup.NoteText.updatePinVisibility()};return e}();d.IsolateZoomHelper=e})(Communicator||(Communicator={}));
(function(d){(function(e){var g=function(c){function a(a,f,h){c.call(this,"rightclick",a,f,h);this.containerId=a;this._initEvents()}__extends(a,c);a.prototype._initEvents=function(){var a=this;this._viewer.setCallbacks({contextMenu:function(b){a.doContext(b)}})};a.prototype.doContext=function(a){var b=this,c=new d.PickConfig(d.SelectionMask.All);this._viewer.getView().pickFromPoint(a,c).then(function(f){var c=b._viewer.getModel().getNodeType(f.getNodeId());c==d.NodeType.PMI||c==d.NodeType.PMIBody||
1==f.overlayIndex()?b.setActiveItemId(null):b.setActiveItemId(f.getNodeId());b._position=f.getPosition();b.showElements(a)})};a.prototype._onContextLayerClick=function(a){2==a.button?this.doContext(new d.Point2(a.pageX,a.pageY)):c.prototype._onContextLayerClick.call(this,a)};return a}(e.Context.ContextMenu);e.RightClickContextMenu=g})(d.Ui||(d.Ui={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var e=function(){return function(a){this._node=a;this._clone=a.cloneNode(!0)}}(),c=function(){function a(a){this._containerId=a;this._image=null;this._additionalNodes=[];this._clientBoundingRects=[];for(a=0;4>a;a++){var b=document.body.getBoundingClientRect();this._clientBoundingRects.push(b)}}a.prototype.start=function(a,f,c){var b=this;return new Promise(function(h,d){b.takeSnapshot(b,f,c,h,a)})};a.prototype.takeSnapshot=function(a,f,c,d,p){void 0===f&&(f=0);void 0===c&&
(c=0);if(0==f||0==c)f=document.body.clientWidth,c=document.body.clientHeight;var b=document.getElementById(this._containerId+"-canvas-container"),h=document.getElementById(this._containerId+"-redline"),k=this._findCanvas(b).toDataURL(),e=new Image;e.onload=function(){e.style.position="absolute";e.style.width="100%";e.style.height="100%";e.style.top="0px";e.style.left="0px";e.style.zIndex="1000000";e.id="temp-image";document.body.appendChild(e);var k=f/b.clientWidth*100,m=c/b.clientHeight*100;b.style.width=
k+"%";b.style.height=m+"%";h.style.width=k+"%";h.style.height=m+"%";var l=p.getAllowHighDPI();p._graphicsEngine.setAllowHighDPI(!1);p._graphicsEngine._tcc.setEventHandler("draw_complete",function(){a.capture(b,d);b.style.width="100%";b.style.height="100%";h.style.width="100%";h.style.height="100%";var f=document.getElementById("temp-image");null!=f&&document.body.removeChild(f);p._graphicsEngine.setAllowHighDPI(l);p._graphicsEngine.resize();p._graphicsEngine._tcc.setEventHandler("draw_complete",null)});
p._graphicsEngine.redraw();p._graphicsEngine.resize()};e.src=k};a.prototype.addCaptureNodes=function(a){a=document.getElementById(a);if(null!=a){var b=new e(a);this._additionalNodes.push(b);a=a.getBoundingClientRect();this._clientBoundingRects.push(a)}};a.prototype.reformatMarkerStyle=function(a){for(var b=(new DOMParser).parseFromString(a,"text/xml"),c=b.getElementsByTagName("defs"),d=[],e=0;e<c.length;e++)for(var l=c[0].getElementsByTagName("marker"),m=0;m<l.length;m++)d.push(l.item(m));c=[];b=
b.getElementsByTagName("line");for(e=0;e<b.length;e++)if(l=b[e],0<l.style.marker.length){for(var m=l.style.marker.indexOf("#")+1,n=l.style.marker.indexOf('"',m+1),n=l.style.marker.substring(m,n),g=null,q=null,m=0;m<d.length;m++)if(d[m].id==n){g=d[m];q=d[m+1];break}c.push({line:l,start:g,end:q})}for(d=a.indexOf("marker: url");0<=d;){m=a.indexOf(")",d)+1;e=a.substring(d,m);b=e.indexOf("#")+1;l=e.indexOf('"',b);n=e.indexOf("&quot",b+11+1);g=l;if(-1==l||n<l)g=n;b=e.substring(b,g);for(e=0;e<c.length;e++)if(c[e].start.id==
b){b="marker-start: url('#"+c[e].start.id+"');";b+="marker-end: url('#"+c[e].end.id+"')";a=a.slice(0,d)+b+a.slice(m);break}d=a.indexOf("marker: url",m+1)}return a};a.prototype.convertToImage64=function(a){var b={svg:null,image64:null};b.svg=document.getElementById(a);a=(new XMLSerializer).serializeToString(b.svg);a=this.reformatMarkerStyle(a);a=btoa(a);b.image64="data:image/svg+xml;base64,"+a;return b};a.prototype.compositeScreenShot=function(a,f,c,d,e,l){for(e=0;e<d.length;e++){var b=d[e];if(e<this._clientBoundingRects.length){var h=
this._clientBoundingRects[e];c.drawImage(b,h.left,h.top)}else c.drawImage(b,0,0)}a.src=f.toDataURL();a.onload=function(){l(a)}};a.prototype.getAllChildren=function(a,f){if(!(0>=f.childNodes.length))for(var b=0;b<f.childNodes.length;b++){var c=f.childNodes[b];a.push(c);this.getAllChildren(a,c)}};a.prototype.cleanupAfterSnap=function(a){for(var b=0;b<a._additionalNodes.length;b++){var c=a._additionalNodes[b],d=c._node;c._clone.getBoundingClientRect();var e=null,c=c._clone;for(e in c.style)d.style[e]=
c.style[e]}a._additionalNodes=[];a._clientBoundingRects=[];for(b=0;4>b;b++)d=document.body.getBoundingClientRect(),a._clientBoundingRects.push(d)};a.prototype.captureAdditionalNodes=function(a,f,c,d){if(0>=this._additionalNodes.length)this.compositeScreenShot(this._image,f,c,a,this._clientBoundingRects,d),this.cleanupAfterSnap(this);else for(var b=this,h=[],e=null,k=0;k<this._additionalNodes.length;k++)e=this._additionalNodes[k],e=e._node,h.push(e.getBoundingClientRect()),e.style.top="0px",e.style.left=
"0px",html2canvas(e,{background:void 0}).then(function(h){var e=new Image;e.onload=function(h){a.push(this);if(a.length-4>=b._additionalNodes.length){for(h=0;h<b._additionalNodes.length;h++)for(var e=h;e<b._additionalNodes.length;e++)if(b._additionalNodes[h]._node==a[e+4].userData){var k=a[h+4];a[h+4]=a[e+4];a[e+4]=k}b.compositeScreenShot(b._image,f,c,a,b._clientBoundingRects,d);b.cleanupAfterSnap(b)}}.bind(e);e.userData=this;e.src=h.toDataURL()}.bind(e))};a.prototype.capture=function(a,f){a=this._findCanvas(a);
var b=a.toDataURL(),c=document.createElement("canvas"),d=c.getContext("2d");c.width=a.clientWidth;c.height=a.clientHeight;c.style.width="100%";c.style.height="100%";var e=new Image,g=new Image,n=new Image,r=new Image;this._image=new Image;var q=0,t=this,u=document.getElementById(t._containerId+"-redline-svg"),v=document.getElementById(t._containerId+"-svg");n.onload=function(){n.width=u.clientWidth;n.height=u.clientHeight;++q;4<=q&&t.captureAdditionalNodes([g,e,n,r],c,d,f)};g.onload=function(){++q;
4<=q&&t.captureAdditionalNodes([g,e,n,r],c,d,f)};e.onload=function(){e.width=v.clientWidth;e.height=v.clientHeight;++q;4<=q&&t.captureAdditionalNodes([g,e,n,r],c,d,f)};g.src=b;a=document.createElement("canvas");b=(new XMLSerializer).serializeToString(u);document.getElementById(this._containerId).appendChild(a);canvg(a,b);n.src=a.toDataURL();document.getElementById(this._containerId).removeChild(a);a=document.createElement("canvas");b=(new XMLSerializer).serializeToString(v);b=this.reformatMarkerStyle(b);
document.getElementById(this._containerId).appendChild(a);canvg(a,b);e.src=a.toDataURL();document.getElementById(this._containerId).removeChild(a);var w=document.getElementById(t._containerId+"-redline"),t=this;html2canvas(w,{background:void 0}).then(function(a){a=a.toDataURL();r.onload=function(){++q;r.width=w.clientWidth;r.height=w.clientHeight;4<=q&&t.captureAdditionalNodes([g,e,n,r],c,d,f)};r.src=a})};a.prototype._findCanvas=function(a){if(a instanceof HTMLCanvasElement&&0<a.clientWidth&&0<a.clientHeight)return a;
for(var b=0;b<a.childNodes.length;b++){var c=this._findCanvas(a.childNodes[b]);if(c)return c}return null};return a}();d.SnapShot=c})(d.Ui||(d.Ui={}))})(Communicator||(Communicator={}));
(function(d){(function(e){var g=function(){function c(a,b){this._bottomLeftOffset=new d.Point2(10,10);this._opacity=.5;this._spinnerImageUrl="css/images/spinner.gif";this._spinnerSize=new d.Point2(31,31);this._isInit=!1;this._container=document.getElementById(a);this._viewer=b;this._initElements();this._initEvents()}c.prototype.show=function(){this._container.style.display="block"};c.prototype.hide=function(){this._container.style.display="none"};c.prototype.setBottomLeftOffset=function(a){this._bottomLeftOffset.assign(a);
this._isInit&&(this._container.style.bottom=this._bottomLeftOffset.y+"px",this._container.style.left=this._bottomLeftOffset.x+"px")};c.prototype.getBottomLeftOffset=function(){return this._bottomLeftOffset.copy()};c.prototype.setSpinnerImage=function(a,b){this._spinnerImageUrl=a;this._spinnerSize.assign(b);this._isInit&&(this._container.style.backgroundImage="url("+this._spinnerImageUrl+")",this._container.style.width=this._spinnerSize.x+"px",this._container.style.height=this._spinnerSize.y+"px")};
c.prototype._initElements=function(){this._container.style.position="absolute";this._container.style.width=this._spinnerSize.x+"px";this._container.style.height=this._spinnerSize.y+"px";this._container.style.bottom=this._bottomLeftOffset.y+"px";this._container.style.left=this._bottomLeftOffset.x+"px";this._container.style.backgroundImage="url("+this._spinnerImageUrl+")";this._container.style.opacity=this._opacity.toString();this._isInit=!0};c.prototype._initEvents=function(){var a=this;this._viewer.setCallbacks({streamingActivated:function(){a._onStreamingActivated()},
streamingDeactivated:function(){a._onStreamingDeactivated()}})};c.prototype._onStreamingActivated=function(){this.show()};c.prototype._onStreamingDeactivated=function(){this.hide()};return c}();e.StreamingIndicator=g})(d.Ui||(d.Ui={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var e=function(){function c(a){this._containerId=a;this._initElements()}c.prototype._initElements=function(){var a=this;this._windowElement=document.createElement("div");this._windowElement.classList.add("ui-timeout-window");this._windowElement.classList.add("desktop-ui-window");this._headerDiv=document.createElement("div");this._headerDiv.classList.add("desktop-ui-window-header");var b=document.createElement("div");b.classList.add("desktop-ui-window-content");this._textDiv=
document.createElement("div");b.appendChild(this._textDiv);var c=document.createElement("div");c.classList.add("desktop-ui-window-divider");b.appendChild(c);document.createElement("div");c=document.createElement("button");c.innerHTML="\u786e\u5b9a";$(c).click(function(){a._onOkButtonClick()});b.appendChild(c);this._windowElement.appendChild(this._headerDiv);this._windowElement.appendChild(b);document.getElementById(this._containerId).appendChild(this._windowElement)};c.prototype._onOkButtonClick=
function(){this.hide()};c.prototype.show=function(){$(this._windowElement).show()};c.prototype.hide=function(){$(this._windowElement).hide()};c.prototype.setText=function(a){$(this._textDiv).empty();this._textDiv.appendChild(document.createTextNode(a))};c.prototype.setTitle=function(a){$(this._headerDiv).empty();this._headerDiv.appendChild(document.createTextNode(a))};return c}();d.UiDialog=e})(d.Ui||(d.Ui={}))})(Communicator||(Communicator={}));
(function(d){(function(d){var e=function(c){function a(a,f){c.call(this,a);this._viewer=f;this._initEvents();this.setTitle("\u8d85\u65f6\u63d0\u9192")}__extends(a,c);a.prototype._initEvents=function(){var a=this;this._viewer.setCallbacks({timeoutWarning:function(){a._onTimeoutWarning()},timeout:function(){a._onTimeout()}})};a.prototype._onTimeoutWarning=function(){this.setText("\u60a8\u7684\u4f1a\u8bdd\u5c06\u88ab\u7ec8\u6b62.\u8bf7\u70b9\u51fb\u201c\u786e\u5b9a\u201d\u6309\u94ae\u7ee7\u7eed\u8bbf\u95ee.");
this.show()};a.prototype._onOkButtonClick=function(){this._viewer.resetClientTimeout();c.prototype._onOkButtonClick.call(this)};a.prototype._onTimeout=function(){this.setText("\u7531\u4e8e\u957f\u65f6\u95f4\u672a\u64cd\u4f5c,\u60a8\u7684\u4f1a\u8bdd\u5df2\u7ecf\u88ab\u7ec8\u6b62.");this.show()};return a}(d.UiDialog);d.TimeoutWarningDialog=e})(d.Ui||(d.Ui={}))})(Communicator||(Communicator={}));
(function(d){(function(e){var g=function(){function c(a,b,c,e,k,g){var f=this;f.containerId=g;void 0===k&&(k=d.ScreenConfiguration.Desktop);this._toolbarSelector="#"+g+"toolBar";this._screenElementSelector="#"+this.containerId;this._submenuHeightOffset=10;this._viewOrientationDuration=500;this._activeSubmenu=null;this._hwvMethods={};this._actions={};this._isInit=!1;this._viewer=a;this._screenConfiguration=k;this._cuttingPlaneController=b;this._viewerSettings=new d.Ui.Desktop.ViewerSettings(a,c,e,
g);this._viewer.setCallbacks({selection:function(a){f._onPartSelection(a)}})}c.prototype.init=function(){var a=this;this._isInit||(this._initIcons(),this._removeNonApplicableIcons(),$(".carsview-tool").bind("click",function(b){b.preventDefault();a._processButtonClick(b);return!1}),$(".submenu-icon").bind("click",function(b){b.preventDefault();a._submenuIconClick(b);return!1}),$(this._toolbarSelector).bind("touchmove",function(a){a.originalEvent.preventDefault()}),$(this._toolbarSelector).bind("mouseenter",
function(){a._mouseEnter()}),$(this._toolbarSelector).bind("mouseleave",function(){a._mouseLeave()}),$(".tool-icon, .submenu-icon").bind("mouseenter",function(b){a._mouseEnterItem(b)}),$(".tool-icon, .submenu-icon").bind("mouseleave",function(b){a._mouseLeaveItem(b)}),$(window).resize(function(){a.reposition()}),$(this._toolbarSelector).click(function(){null!=a._activeSubmenu&&a._hideActiveSubmenu()}),$(".toolbar-cp-plane").click(function(b){a._cuttingPlaneButtonClick(b)}),this._viewer.setCallbacks({modelSwitched:function(){a._hideActiveSubmenu()}}),
this._initSliders(),this._initActions(),this._initSnapshot(a.containerId),this.updateEdgeFaceButton(),this.reposition(),this.show(),this._isInit=!0)};c.prototype.disableSubmenuItem=function(a){var b=this;"string"==typeof a?$("#"+b.containerId+"submenus .toolbar-"+a).addClass("disabled"):"object"==typeof a&&$.each(a,function(a,c){$("#"+b.containerId+"submenus .toolbar-"+c).addClass("disabled")})};c.prototype.enableSubmenuItem=function(a){var b=this;"string"==typeof a?$("#"+b.containerId+"submenus .toolbar-"+
a).removeClass("disabled"):"object"==typeof a&&$.each(a,function(a,c){$("#"+b.containerId+"submenus .toolbar-"+c).removeClass("disabled")})};c.prototype.setCorrespondingButtonForSubmenuItem=function(a){this._activateSubmenuItem(a)};c.prototype._mouseEnterItem=function(a){a=$(a.target);a.hasClass("disabled")||a.addClass("hover")};c.prototype._mouseLeaveItem=function(a){$(a.target).removeClass("hover")};c.prototype.show=function(){$(this._toolbarSelector).show()};c.prototype.hide=function(){$(this._toolbarSelector).hide()};
c.prototype._initSliders=function(){var a=this;$("#"+a.containerId+"explosion-slider").slider({orientation:"vertical",min:0,max:200,value:0,slide:function(b,c){a._onExplosionSilder(c.value/100)}})};c.prototype._mouseEnter=function(){if(null==this._activeSubmenu){var a=$(this._toolbarSelector).find(".toolbar-tools");a.stop();a.css({opacity:1})}};c.prototype._mouseLeave=function(){null==this._activeSubmenu&&$(".toolbar-tools").animate({opacity:.6},500,function(){})};c.prototype.reposition=function(){var a=
$(this._toolbarSelector),b=$(this._screenElementSelector).width()/2-a.width()/2;a.css({left:b+"px",bottom:"15px"})};c.prototype._processButtonClick=function(a){null!=this._activeSubmenu?this._hideActiveSubmenu():a.currentTarget.id==this.containerId+"home-button"?(this._showSubmenu(this.containerId+"home-button"),$(this._toolbarSelector).find(".active-tool").removeClass("active-tool"),a=$(a.target).closest(".carsview-tool"),a.addClass("active-tool"),this._performAction(this.containerId+"home-button")):
a.currentTarget.id==this.containerId+"view-button"?(this._showSubmenu(this.containerId+"view-button"),$(this._toolbarSelector).find(".active-tool").removeClass("active-tool"),a=$(a.target).closest(".carsview-tool"),a.addClass("active-tool"),this._showSubmenu(this.containerId+"view-button")):a.currentTarget.id==this.containerId+"edgeface-button"?(this._showSubmenu(this.containerId+"edgeface-button"),$(this._toolbarSelector).find(".active-tool").removeClass("active-tool"),a=$(a.target).closest(".carsview-tool"),
a.addClass("active-tool"),this._showSubmenu(this.containerId+"edgeface-button")):a.currentTarget.id==this.containerId+"redline-button"?(this._showSubmenu(this.containerId+"redline-button"),$(this._toolbarSelector).find(".active-tool").removeClass("active-tool"),a=$(a.target).closest(".carsview-tool"),a.addClass("active-tool"),this._performAction(this.containerId+"redline-button")):a.currentTarget.id==this.containerId+"click-button"?(this._showSubmenu(this.containerId+"click-button"),$(this._toolbarSelector).find(".active-tool").removeClass("active-tool"),
a=$(a.target).closest(".carsview-tool"),a.addClass("active-tool"),this._showSubmenu(this.containerId+"click-button")):a.currentTarget.id==this.containerId+"camera-button"?(this._showSubmenu(this.containerId+"camera-button"),$(this._toolbarSelector).find(".active-tool").removeClass("active-tool"),a=$(a.target).closest(".carsview-tool"),a.addClass("active-tool"),this._showSubmenu(this.containerId+"camera-button")):a.currentTarget.id==this.containerId+"explode-button"?this._toggleMenuTool(this.containerId+
"explode-button"):a.currentTarget.id==this.containerId+"snapshot-button"?(this._showSubmenu(this.containerId+"snapshot-button"),$(this._toolbarSelector).find(".active-tool").removeClass("active-tool"),a=$(a.target).closest(".carsview-tool"),a.addClass("active-tool"),this._toggleMenuTool(this.containerId+"snapshot-button")):a.currentTarget.id==this.containerId+"settings-button"?(this._showSubmenu(this.containerId+"settings-button"),$(this._toolbarSelector).find(".active-tool").removeClass("active-tool"),
a=$(a.target).closest(".carsview-tool"),a.addClass("active-tool"),this._performAction(this.containerId+"settings-button")):a.currentTarget.id==this.containerId+"cuttingplane-button"&&(this._showSubmenu(this.containerId+"cuttingplane-button"),$(this._toolbarSelector).find(".active-tool").removeClass("active-tool"),a=$(a.target).closest(".carsview-tool"),a.addClass("active-tool"),this._showSubmenu(this.containerId+"cuttingplane-button"))};c.prototype._toggleMenuTool=function(a){var b=$("#"+a).attr("data-submenu"),
b=$("#"+b),c=$("#"+a).attr("data-operatorclass");b.is(":visible")?(b.hide(),this._performAction(c,!1)):(this._alignMenuToTool(b,a),this._performAction(c,!0))};c.prototype._startModal=function(){var a=this;$(this.containerId).append("<div id='"+a.containerId+"toolbar-modal' class='toolbar-modal-overlay'></div>");$("#"+a.containerId+"toolbar-modal").bind("click",function(){a._hideActiveSubmenu()})};c.prototype._alignMenuToTool=function(a,b){b=$("#"+b).position().left;this._screenConfiguration==d.ScreenConfiguration.Mobile&&
(b/=1.74);b=b-a.width()/2+20;var c=-(this._submenuHeightOffset+a.height());a.css({display:"block",top:c+"px",left:b})};c.prototype._showSubmenu=function(a){this._hideActiveSubmenu();var b=$("#"+a).attr("data-submenu");null!=b&&(b=$(this._toolbarSelector+" #"+this.containerId+"submenus #"+b),b.hasClass("disabled")||(this._alignMenuToTool(b,a),this._activeSubmenu=b[0],this._startModal(),$(this._toolbarSelector).find(".toolbar-tools").css({opacity:.3})))};c.prototype._hideActiveSubmenu=function(){$("#"+
this.containerId+"toolbar-modal").remove();null!=this._activeSubmenu&&($(this._activeSubmenu).hide(),$(this._toolbarSelector).find(".toolbar-tools").css({opacity:1}));this._activeSubmenu=null};c.prototype._activateSubmenuItem=function(a){var b=$("#"+a).attr("data-operatorclass"),c=$("#"+a).attr("title");a=$("#"+a).parent().parent().parent().parent().parent();a=$("#"+a.attr("data-button"));var d=a.find(".tool-icon");d.length&&(d.removeClass(a.data("operatorclass").toString()),d.addClass(b),a.data("operatorclass",
b),a.attr("title",c));return b};c.prototype._submenuIconClick=function(a){0<$("#"+a.currentTarget.id).attr("class").indexOf("disabled")||(a=a.currentTarget.id,a==this.containerId+"redline-circle-button"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"redline-rectangle-button"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"redline-note"?(a=this.containerId+
this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"redline-freehand"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"operator-camera-walk"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"operator-camera-turntable"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):
a==this.containerId+"operator-camera-orbit"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"viewport-wireframe-on-shaded"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"viewport-shaded"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"viewport-hidden-lines"?(a=this.containerId+this._activateSubmenuItem(a),
this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"viewport-wireframe"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"view-face"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"view-iso"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"view-ortho"?(a=this.containerId+
this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"view-persp"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"view-left"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"view-right"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"view-bottom"?
(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"view-front"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"view-back"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"view-top"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+
"note-button"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"measure-angle-between-faces"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"measure-distance-between-faces"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"measure-edges"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),
this._performAction(a)):a==this.containerId+"measure-point-to-point"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"select-parts"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"area-select"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"cuttingplane-face"?(a=this.containerId+this._activateSubmenuItem(a),
this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"cuttingplane-x"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"cuttingplane-section"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"cuttingplane-y"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"cuttingplane-toggle"?
(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"cuttingplane-z"?(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)):a==this.containerId+"cuttingplane-reset"&&(a=this.containerId+this._activateSubmenuItem(a),this._hideActiveSubmenu(),this._performAction(a)))};c.prototype._initIcons=function(){$(this._toolbarSelector).find(".carsview-tool").each(function(){var a=$(this);a.find(".tool-icon").addClass(a.data("operatorclass").toString())});
$(this._toolbarSelector).find(".submenu-icon").each(function(){var a=$(this);a.addClass(a.data("operatorclass").toString())})};c.prototype._removeNonApplicableIcons=function(){this._screenConfiguration==d.ScreenConfiguration.Mobile&&$("#"+this.containerId+"snapshot-button").remove()};c.prototype.setSubmenuEnabled=function(a,b){a=$("#"+a);var c=$("#"+a.data("submenu"));b?(a.find(".smarrow").show(),c.removeClass("disabled")):(a.find(".smarrow").hide(),c.addClass("disabled"))};c.prototype._performAction=
function(a,b){void 0===b&&(b=null);var c=this._actions[a];c&&c.apply(null,[a,b])};c.prototype._renderModeClick=function(a){var b=this._viewer.getView();switch(a){case this.containerId+"toolbar-shaded":b.setDrawMode(d.DrawMode.Shaded);break;case this.containerId+"toolbar-wireframe":b.setDrawMode(d.DrawMode.Wireframe);break;case this.containerId+"toolbar-hidden-line":b.setDrawMode(d.DrawMode.HiddenLine);break;default:b.setDrawMode(d.DrawMode.WireframeOnShaded)}};c.prototype._initSnapshot=function(){var a=
this;$("#"+a.containerId+"snapshot-dialog-cancel-button").click(function(){$("#"+a.containerId+"snapshot-dialog").hide()})};c.prototype._doSnapshot=function(){var a=$("#"+this.containerId),b=a.width(),c=a.height(),a=this._viewer.getView().getCanvasSize(),e=480,k=a.x/a.y*e,e=.7*e,k=.7*k,g=k+40,l=this;(new d.Ui.SnapShot(this.containerId)).start(this._viewer,a.x,a.y).then(function(a){var f=(b-k)/2+$("#"+l.containerId).offset().left,d=(c-e)/2+$("#"+l.containerId).offset().top,h=$("#"+l.containerId+"snapshot-dialog");
$("#"+l.containerId+"snapshot-dialog-image").attr("src",a.src).attr("width",g).attr("height",e+40);h.css({top:d.toString()+"px",left:f.toString()+"px"});h.show()})};c.prototype._setRedlineOperator=function(a){null==this._viewer.getMarkupManager().getActiveMarkupView()&&this._viewer.getMarkupManager().createMarkupView();this._viewer.getOperatorManager().set(a,1)};c.prototype._initActions=function(){var a=this;this._actions[a.containerId+"home-button"]=function(){if(a._viewer.getModel().isDrawing()){var b=
a._viewer.getActiveSheetId();null!==b&&a._viewer.getView().isolateNodes([b])}else a._viewer.reset(),d.Markup.NoteText.setIsolateActive(!1),d.Markup.NoteText.updatePinVisibility(),b=a._viewer.getOperatorManager().getOperator(d.OperatorId.Handle),null!==b&&b.removeHandles&&b.removeHandles()};this._actions[a.containerId+"toolbar-redline-circle"]=function(){a._setRedlineOperator(d.OperatorId.RedlineCircle)};this._actions[a.containerId+"toolbar-redline-freehand"]=function(){a._setRedlineOperator(d.OperatorId.RedlinePolyline)};
this._actions[a.containerId+"toolbar-redline-rectangle"]=function(){a._setRedlineOperator(d.OperatorId.RedlineRectangle)};this._actions[a.containerId+"toolbar-redline-note"]=function(){a._setRedlineOperator(d.OperatorId.RedlineText)};this._actions[a.containerId+"toolbar-note"]=function(){a._viewer.getOperatorManager().set(d.OperatorId.Note,1)};this._actions[a.containerId+"toolbar-select"]=function(){a._viewer.getOperatorManager().set(d.OperatorId.Select,1)};this._actions[a.containerId+"toolbar-area-select"]=
function(){a._viewer.getOperatorManager().set(d.OperatorId.AreaSelect,1)};this._actions[a.containerId+"toolbar-orbit"]=function(){a._viewer.getOperatorManager().set(d.OperatorId.Navigate,0)};this._actions[a.containerId+"toolbar-turntable"]=function(){a._viewer.getOperatorManager().set(d.OperatorId.Turntable,0)};this._actions[a.containerId+"toolbar-walk"]=function(){a._viewer.getOperatorManager().set(d.OperatorId.Walk,0)};this._actions[a.containerId+"toolbar-face"]=function(){a._orientToFace()};this._actions[a.containerId+
"toolbar-measure-point"]=function(){a._viewer.getOperatorManager().set(d.OperatorId.MeasurePointPointDistance,1)};this._actions[a.containerId+"toolbar-measure-edge"]=function(){a._viewer.getOperatorManager().set(d.OperatorId.MeasureEdgeLength,1)};this._actions[a.containerId+"toolbar-measure-distance"]=function(){a._viewer.getOperatorManager().set(d.OperatorId.MeasureFaceFaceDistance,1)};this._actions[a.containerId+"toolbar-measure-angle"]=function(){a._viewer.getOperatorManager().set(d.OperatorId.MeasureFaceFaceAngle,
1)};this._actions[a.containerId+"toolbar-cuttingplane"]=function(a,b){};this._actions["toolbar-explode"]=function(b,c){a._explosionButtonClick(c)};this._actions[a.containerId+"settings-button"]=function(b,c){a._settingsButtonClick()};var b=function(b){a._renderModeClick(b)};this._actions[a.containerId+"toolbar-wireframeshaded"]=b;this._actions[a.containerId+"toolbar-shaded"]=b;this._actions[a.containerId+"toolbar-wireframe"]=b;this._actions[a.containerId+"toolbar-hidden-line"]=b;this._actions[a.containerId+
"toolbar-front"]=function(){a._viewer.getView().setViewOrientation(d.ViewOrientation.Front,a._viewOrientationDuration)};this._actions[a.containerId+"toolbar-back"]=function(){a._viewer.getView().setViewOrientation(d.ViewOrientation.Back,a._viewOrientationDuration)};this._actions[a.containerId+"toolbar-left"]=function(){a._viewer.getView().setViewOrientation(d.ViewOrientation.Left,a._viewOrientationDuration)};this._actions[a.containerId+"toolbar-right"]=function(){a._viewer.getView().setViewOrientation(d.ViewOrientation.Right,
a._viewOrientationDuration)};this._actions[a.containerId+"toolbar-bottom"]=function(){a._viewer.getView().setViewOrientation(d.ViewOrientation.Bottom,a._viewOrientationDuration)};this._actions[a.containerId+"toolbar-top"]=function(){a._viewer.getView().setViewOrientation(d.ViewOrientation.Top,a._viewOrientationDuration)};this._actions[a.containerId+"toolbar-iso"]=function(){a._viewer.getView().setViewOrientation(d.ViewOrientation.Iso,a._viewOrientationDuration)};this._actions[a.containerId+"toolbar-ortho"]=
function(){a._viewer.getView().setProjectionMode(d.Projection.Orthographic)};this._actions[a.containerId+"toolbar-persp"]=function(){a._viewer.getView().setProjectionMode(d.Projection.Perspective)};this._actions["toolbar-snapshot"]=function(){a._doSnapshot()}};c.prototype._onExplosionSilder=function(a){this._viewer.getExplodeManager().setMagnitude(a)};c.prototype._explosionButtonClick=function(a){var b=this._viewer.getExplodeManager();a&&!b.getActive()&&b.start()};c.prototype._settingsButtonClick=
function(){this._viewerSettings.show()};c.prototype.updateEdgeFaceButton=function(){var a=this._viewer.getView(),b=a.getLineVisibility(),a=a.getFaceVisibility();b&&a?this.setCorrespondingButtonForSubmenuItem(this.containerId+"viewport-wireframe-on-shaded"):!b&&a?this.setCorrespondingButtonForSubmenuItem(this.containerId+"viewport-shaded"):this.setCorrespondingButtonForSubmenuItem(this.containerId+"viewport-wireframe")};c.prototype._cuttingPlaneButtonClick=function(a){if(a.currentTarget.id==this.containerId+
"cuttingplane-face"){var b=$("#"+a.currentTarget.id).attr("class");if(0<=b.indexOf("toolbar-cp-plane")){b=$("#"+a.currentTarget.id).attr("data-plane");a=$("#"+a.currentTarget.id);var c=this._cuttingPlaneController.getCount();if("x"==b||"y"==b||"z"==b||"face"==b){this._cuttingPlaneController.toggle(b);a.removeClass("selected");a.removeClass("inverted");var d=this._cuttingPlaneController.getCount();d>c?a.addClass("selected"):d==c&&0<d&&"face"!=b&&a.addClass("inverted");0<d?($("#"+this.containerId+"cuttingplane-section").removeClass("disabled"),
$("#"+this.containerId+"cuttingplane-reset").removeClass("disabled")):($("#"+this.containerId+"cuttingplane-section").addClass("disabled"),$("#"+this.containerId+"cuttingplane-reset").addClass("disabled"));1<d?$("#"+this.containerId+"cuttingplane-toggle").removeClass("disabled"):$("#"+this.containerId+"cuttingplane-toggle").addClass("disabled")}else"section"==b?(this._cuttingPlaneController.toggleReferenceGeometry(),a.hasClass("selected")?a.removeClass("selected"):a.addClass("selected")):"toggle"==
b?(this._cuttingPlaneController.toggleCuttingMode(),a.hasClass("selected")?a.removeClass("selected"):a.addClass("selected")):"reset"==b&&(this._cuttingPlaneController.resetCuttingPlanes(),$("#"+this.containerId+"cuttingplane-reset").addClass("disabled"),$("#"+this.containerId+"cuttingplane-section").addClass("disabled"),$("#"+this.containerId+"cuttingplane-section").removeClass("selected"),$("#"+this.containerId+"cuttingplane-toggle").addClass("disabled"),$("#"+this.containerId+"cuttingplane-toggle").removeClass("selected"),
$("#"+this.containerId+"cuttingplane-x").removeClass("selected"),$("#"+this.containerId+"cuttingplane-y").removeClass("selected"),$("#"+this.containerId+"cuttingplane-z").removeClass("selected"),$("#"+this.containerId+"cuttingplane-face").removeClass("selected"),$("#"+this.containerId+"cuttingplane-x").removeClass("inverted"),$("#"+this.containerId+"cuttingplane-y").removeClass("inverted"),$("#"+this.containerId+"cuttingplane-z").removeClass("inverted"),$("#"+this.containerId+"cuttingplane-face").removeClass("inverted"))}}else a.currentTarget.id==
this.containerId+"cuttingplane-x"?(b=$("#"+a.currentTarget.id).attr("class"),0<=b.indexOf("toolbar-cp-plane")&&(b=$("#"+a.currentTarget.id).attr("data-plane"),a=$("#"+a.currentTarget.id),c=this._cuttingPlaneController.getCount(),"x"==b||"y"==b||"z"==b||"face"==b?(this._cuttingPlaneController.toggle(b),a.removeClass("selected"),a.removeClass("inverted"),d=this._cuttingPlaneController.getCount(),d>c?a.addClass("selected"):d==c&&0<d&&"face"!=b&&a.addClass("inverted"),0<d?($("#"+this.containerId+"cuttingplane-section").removeClass("disabled"),
$("#"+this.containerId+"cuttingplane-reset").removeClass("disabled")):($("#"+this.containerId+"cuttingplane-section").addClass("disabled"),$("#"+this.containerId+"cuttingplane-reset").addClass("disabled")),1<d?$("#"+this.containerId+"cuttingplane-toggle").removeClass("disabled"):$("#"+this.containerId+"cuttingplane-toggle").addClass("disabled")):"section"==b?(this._cuttingPlaneController.toggleReferenceGeometry(),a.hasClass("selected")?a.removeClass("selected"):a.addClass("selected")):"toggle"==b?
(this._cuttingPlaneController.toggleCuttingMode(),a.hasClass("selected")?a.removeClass("selected"):a.addClass("selected")):"reset"==b&&(this._cuttingPlaneController.resetCuttingPlanes(),$("#"+this.containerId+"cuttingplane-reset").addClass("disabled"),$("#"+this.containerId+"cuttingplane-section").addClass("disabled"),$("#"+this.containerId+"cuttingplane-section").removeClass("selected"),$("#"+this.containerId+"cuttingplane-toggle").addClass("disabled"),$("#"+this.containerId+"cuttingplane-toggle").removeClass("selected"),
$("#"+this.containerId+"cuttingplane-x").removeClass("selected"),$("#"+this.containerId+"cuttingplane-y").removeClass("selected"),$("#"+this.containerId+"cuttingplane-z").removeClass("selected"),$("#"+this.containerId+"cuttingplane-face").removeClass("selected"),$("#"+this.containerId+"cuttingplane-x").removeClass("inverted"),$("#"+this.containerId+"cuttingplane-y").removeClass("inverted"),$("#"+this.containerId+"cuttingplane-z").removeClass("inverted"),$("#"+this.containerId+"cuttingplane-face").removeClass("inverted")))):
a.currentTarget.id==this.containerId+"cuttingplane-section"?(b=$("#"+a.currentTarget.id).attr("class"),0<=b.indexOf("toolbar-cp-plane")&&(b=$("#"+a.currentTarget.id).attr("data-plane"),a=$("#"+a.currentTarget.id),c=this._cuttingPlaneController.getCount(),"x"==b||"y"==b||"z"==b||"face"==b?(this._cuttingPlaneController.toggle(b),a.removeClass("selected"),a.removeClass("inverted"),d=this._cuttingPlaneController.getCount(),d>c?a.addClass("selected"):d==c&&0<d&&"face"!=b&&a.addClass("inverted"),0<d?($("#"+
this.containerId+"cuttingplane-section").removeClass("disabled"),$("#"+this.containerId+"cuttingplane-reset").removeClass("disabled")):($("#"+this.containerId+"cuttingplane-section").addClass("disabled"),$("#"+this.containerId+"cuttingplane-reset").addClass("disabled")),1<d?$("#"+this.containerId+"cuttingplane-toggle").removeClass("disabled"):$("#"+this.containerId+"cuttingplane-toggle").addClass("disabled")):"section"==b?(this._cuttingPlaneController.toggleReferenceGeometry(),a.hasClass("selected")?
a.removeClass("selected"):a.addClass("selected")):"toggle"==b?(this._cuttingPlaneController.toggleCuttingMode(),a.hasClass("selected")?a.removeClass("selected"):a.addClass("selected")):"reset"==b&&(this._cuttingPlaneController.resetCuttingPlanes(),$("#"+this.containerId+"cuttingplane-reset").addClass("disabled"),$("#"+this.containerId+"cuttingplane-section").addClass("disabled"),$("#"+this.containerId+"cuttingplane-section").removeClass("selected"),$("#"+this.containerId+"cuttingplane-toggle").addClass("disabled"),
$("#"+this.containerId+"cuttingplane-toggle").removeClass("selected"),$("#"+this.containerId+"cuttingplane-x").removeClass("selected"),$("#"+this.containerId+"cuttingplane-y").removeClass("selected"),$("#"+this.containerId+"cuttingplane-z").removeClass("selected"),$("#"+this.containerId+"cuttingplane-face").removeClass("selected"),$("#"+this.containerId+"cuttingplane-x").removeClass("inverted"),$("#"+this.containerId+"cuttingplane-y").removeClass("inverted"),$("#"+this.containerId+"cuttingplane-z").removeClass("inverted"),
$("#"+this.containerId+"cuttingplane-face").removeClass("inverted")))):a.currentTarget.id==this.containerId+"cuttingplane-y"?(b=$("#"+a.currentTarget.id).attr("class"),0<=b.indexOf("toolbar-cp-plane")&&(b=$("#"+a.currentTarget.id).attr("data-plane"),a=$("#"+a.currentTarget.id),c=this._cuttingPlaneController.getCount(),"x"==b||"y"==b||"z"==b||"face"==b?(this._cuttingPlaneController.toggle(b),a.removeClass("selected"),a.removeClass("inverted"),d=this._cuttingPlaneController.getCount(),d>c?a.addClass("selected"):
d==c&&0<d&&"face"!=b&&a.addClass("inverted"),0<d?($("#"+this.containerId+"cuttingplane-section").removeClass("disabled"),$("#"+this.containerId+"cuttingplane-reset").removeClass("disabled")):($("#"+this.containerId+"cuttingplane-section").addClass("disabled"),$("#"+this.containerId+"cuttingplane-reset").addClass("disabled")),1<d?$("#"+this.containerId+"cuttingplane-toggle").removeClass("disabled"):$("#"+this.containerId+"cuttingplane-toggle").addClass("disabled")):"section"==b?(this._cuttingPlaneController.toggleReferenceGeometry(),
a.hasClass("selected")?a.removeClass("selected"):a.addClass("selected")):"toggle"==b?(this._cuttingPlaneController.toggleCuttingMode(),a.hasClass("selected")?a.removeClass("selected"):a.addClass("selected")):"reset"==b&&(this._cuttingPlaneController.resetCuttingPlanes(),$("#"+this.containerId+"cuttingplane-reset").addClass("disabled"),$("#"+this.containerId+"cuttingplane-section").addClass("disabled"),$("#"+this.containerId+"cuttingplane-section").removeClass("selected"),$("#"+this.containerId+"cuttingplane-toggle").addClass("disabled"),
$("#"+this.containerId+"cuttingplane-toggle").removeClass("selected"),$("#"+this.containerId+"cuttingplane-x").removeClass("selected"),$("#"+this.containerId+"cuttingplane-y").removeClass("selected"),$("#"+this.containerId+"cuttingplane-z").removeClass("selected"),$("#"+this.containerId+"cuttingplane-face").removeClass("selected"),$("#"+this.containerId+"cuttingplane-x").removeClass("inverted"),$("#"+this.containerId+"cuttingplane-y").removeClass("inverted"),$("#"+this.containerId+"cuttingplane-z").removeClass("inverted"),
$("#"+this.containerId+"cuttingplane-face").removeClass("inverted")))):a.currentTarget.id==this.containerId+"cuttingplane-toggle"?(b=$("#"+a.currentTarget.id).attr("class"),0<=b.indexOf("toolbar-cp-plane")&&(b=$("#"+a.currentTarget.id).attr("data-plane"),a=$("#"+a.currentTarget.id),c=this._cuttingPlaneController.getCount(),"x"==b||"y"==b||"z"==b||"face"==b?(this._cuttingPlaneController.toggle(b),a.removeClass("selected"),a.removeClass("inverted"),d=this._cuttingPlaneController.getCount(),d>c?a.addClass("selected"):
d==c&&0<d&&"face"!=b&&a.addClass("inverted"),0<d?($("#"+this.containerId+"cuttingplane-section").removeClass("disabled"),$("#"+this.containerId+"cuttingplane-reset").removeClass("disabled")):($("#"+this.containerId+"cuttingplane-section").addClass("disabled"),$("#"+this.containerId+"cuttingplane-reset").addClass("disabled")),1<d?$("#"+this.containerId+"cuttingplane-toggle").removeClass("disabled"):$("#"+this.containerId+"cuttingplane-toggle").addClass("disabled")):"section"==b?(this._cuttingPlaneController.toggleReferenceGeometry(),
a.hasClass("selected")?a.removeClass("selected"):a.addClass("selected")):"toggle"==b?(this._cuttingPlaneController.toggleCuttingMode(),a.hasClass("selected")?a.removeClass("selected"):a.addClass("selected")):"reset"==b&&(this._cuttingPlaneController.resetCuttingPlanes(),$("#"+this.containerId+"cuttingplane-reset").addClass("disabled"),$("#"+this.containerId+"cuttingplane-section").addClass("disabled"),$("#"+this.containerId+"cuttingplane-section").removeClass("selected"),$("#"+this.containerId+"cuttingplane-toggle").addClass("disabled"),
$("#"+this.containerId+"cuttingplane-toggle").removeClass("selected"),$("#"+this.containerId+"cuttingplane-x").removeClass("selected"),$("#"+this.containerId+"cuttingplane-y").removeClass("selected"),$("#"+this.containerId+"cuttingplane-z").removeClass("selected"),$("#"+this.containerId+"cuttingplane-face").removeClass("selected"),$("#"+this.containerId+"cuttingplane-x").removeClass("inverted"),$("#"+this.containerId+"cuttingplane-y").removeClass("inverted"),$("#"+this.containerId+"cuttingplane-z").removeClass("inverted"),
$("#"+this.containerId+"cuttingplane-face").removeClass("inverted")))):a.currentTarget.id==this.containerId+"cuttingplane-z"?(b=$("#"+a.currentTarget.id).attr("class"),0<=b.indexOf("toolbar-cp-plane")&&(b=$("#"+a.currentTarget.id).attr("data-plane"),a=$("#"+a.currentTarget.id),c=this._cuttingPlaneController.getCount(),"x"==b||"y"==b||"z"==b||"face"==b?(this._cuttingPlaneController.toggle(b),a.removeClass("selected"),a.removeClass("inverted"),d=this._cuttingPlaneController.getCount(),d>c?a.addClass("selected"):
d==c&&0<d&&"face"!=b&&a.addClass("inverted"),0<d?($("#"+this.containerId+"cuttingplane-section").removeClass("disabled"),$("#"+this.containerId+"cuttingplane-reset").removeClass("disabled")):($("#"+this.containerId+"cuttingplane-section").addClass("disabled"),$("#"+this.containerId+"cuttingplane-reset").addClass("disabled")),1<d?$("#"+this.containerId+"cuttingplane-toggle").removeClass("disabled"):$("#"+this.containerId+"cuttingplane-toggle").addClass("disabled")):"section"==b?(this._cuttingPlaneController.toggleReferenceGeometry(),
a.hasClass("selected")?a.removeClass("selected"):a.addClass("selected")):"toggle"==b?(this._cuttingPlaneController.toggleCuttingMode(),a.hasClass("selected")?a.removeClass("selected"):a.addClass("selected")):"reset"==b&&(this._cuttingPlaneController.resetCuttingPlanes(),$("#"+this.containerId+"cuttingplane-reset").addClass("disabled"),$("#"+this.containerId+"cuttingplane-section").addClass("disabled"),$("#"+this.containerId+"cuttingplane-section").removeClass("selected"),$("#"+this.containerId+"cuttingplane-toggle").addClass("disabled"),
$("#"+this.containerId+"cuttingplane-toggle").removeClass("selected"),$("#"+this.containerId+"cuttingplane-x").removeClass("selected"),$("#"+this.containerId+"cuttingplane-y").removeClass("selected"),$("#"+this.containerId+"cuttingplane-z").removeClass("selected"),$("#"+this.containerId+"cuttingplane-face").removeClass("selected"),$("#"+this.containerId+"cuttingplane-x").removeClass("inverted"),$("#"+this.containerId+"cuttingplane-y").removeClass("inverted"),$("#"+this.containerId+"cuttingplane-z").removeClass("inverted"),
$("#"+this.containerId+"cuttingplane-face").removeClass("inverted")))):a.currentTarget.id==this.containerId+"cuttingplane-reset"&&(b=$("#"+a.currentTarget.id).attr("class"),0<=b.indexOf("toolbar-cp-plane")&&(b=$("#"+a.currentTarget.id).attr("data-plane"),a=$("#"+a.currentTarget.id),c=this._cuttingPlaneController.getCount(),"x"==b||"y"==b||"z"==b||"face"==b?(this._cuttingPlaneController.toggle(b),a.removeClass("selected"),a.removeClass("inverted"),d=this._cuttingPlaneController.getCount(),d>c?a.addClass("selected"):
d==c&&0<d&&"face"!=b&&a.addClass("inverted"),0<d?($("#"+this.containerId+"cuttingplane-section").removeClass("disabled"),$("#"+this.containerId+"cuttingplane-reset").removeClass("disabled")):($("#"+this.containerId+"cuttingplane-section").addClass("disabled"),$("#"+this.containerId+"cuttingplane-reset").addClass("disabled")),1<d?$("#"+this.containerId+"cuttingplane-toggle").removeClass("disabled"):$("#"+this.containerId+"cuttingplane-toggle").addClass("disabled")):"section"==b?(this._cuttingPlaneController.toggleReferenceGeometry(),
a.hasClass("selected")?a.removeClass("selected"):a.addClass("selected")):"toggle"==b?(this._cuttingPlaneController.toggleCuttingMode(),a.hasClass("selected")?a.removeClass("selected"):a.addClass("selected")):"reset"==b&&(this._cuttingPlaneController.resetCuttingPlanes(),$("#"+this.containerId+"cuttingplane-reset").addClass("disabled"),$("#"+this.containerId+"cuttingplane-section").addClass("disabled"),$("#"+this.containerId+"cuttingplane-section").removeClass("selected"),$("#"+this.containerId+"cuttingplane-toggle").addClass("disabled"),
$("#"+this.containerId+"cuttingplane-toggle").removeClass("selected"),$("#"+this.containerId+"cuttingplane-x").removeClass("selected"),$("#"+this.containerId+"cuttingplane-y").removeClass("selected"),$("#"+this.containerId+"cuttingplane-z").removeClass("selected"),$("#"+this.containerId+"cuttingplane-face").removeClass("selected"),$("#"+this.containerId+"cuttingplane-x").removeClass("inverted"),$("#"+this.containerId+"cuttingplane-y").removeClass("inverted"),$("#"+this.containerId+"cuttingplane-z").removeClass("inverted"),
$("#"+this.containerId+"cuttingplane-face").removeClass("inverted"))))};c.prototype._orientToFace=function(){var a=this._viewer.getSelectionManager().getLast();if(a&&a.getFaceEntity()){var b=a.getFaceEntity().getNormal(),c=a.getPosition(),e=this._viewer.getView().getCamera(),k=d.Point3.cross(b,new d.Point3(0,1,0));.001>k.length()&&(k=d.Point3.cross(b,new d.Point3(1,0,0)));var g=e.getPosition().subtract(e.getTarget()).length();e.setTarget(c);e.setPosition(d.Point3.add(c,d.Point3.scale(b,g)));e.setUp(k);
this._viewer.getView().fitBounding(a.getFaceEntity().getBounding(),400,e)}};c.prototype._onPartSelection=function(a){null==a.getSelection().getNodeId()?($("#"+this.containerId+"cuttingplane-face").addClass("disabled"),$("#"+this.containerId+"view-face").addClass("disabled")):($("#"+this.containerId+"cuttingplane-face").removeClass("disabled"),$("#"+this.containerId+"view-face").removeClass("disabled"))};return c}();e.Toolbar=g})(d.Ui||(d.Ui={}))})(Communicator||(Communicator={}));
(function(d){(function(e){(function(e){var c=function(){function a(a,c,e,k){this._containerId=k;this._versionInfo=!0;this._cappingGeometryLineColor=this._cappingGeometryFaceColor=this._enableFaceLineSelection=this._selectionColorFaceLine=this._selectionColorBody=this._measurementColor=this._backgroundColorBottom=this._backgroundColorTop=null;this._PMIColor=d.Color.black();this._PMIEnabled=!1;this._showCappingGeometry=this._hiddenLineOpacity=this._minFramerate=this._showBackfaces=this._projectionMode=
null;this._orbitCameraTarget=!1;this._antiAliasingEnabled=this._ambientOcclusionRadius=this._ambientOcclusionEnabled=null;this._splatRenderingEnabled=this._navCubeEnabled=this._axisTriadEnabled=!1;this._splatRenderingSize=.003;this._splatRenderingPointSizeUnit=d.PointSizeUnit.ProportionOfBoundingDiagonal;this._eyeDomeLightingEnabled=!1;this._viewer=a;this._axisTriad=c;this._navCube=e;this._initElements()}a.prototype.show=function(){this._readSettings();this._centerWindow();$(this._viewerSettingsSelector).show()};
a.prototype.hide=function(){$(this._viewerSettingsSelector).hide()};a.prototype._centerWindow=function(){var a=$(this._viewerSettingsSelector),c=a.width()+1,d=a.height(),e=this._viewer.getView().getCanvasSize();a.css({top:((e.y-d)/2).toString()+"px",left:((e.x-c)/2).toString()+"px"})};a.prototype._initElements=function(){var a=this,c=this;this._viewerSettingsSelector="#"+c._containerId+"viewer-settings-dialog";$(this._viewerSettingsSelector).draggable({handle:".carsview-ui-window-header"});$("INPUT.color-picker").each(function(){$(this).minicolors({position:$(this).attr("data-position")||
"bottom left",format:"rgb",control:"hue"})});$("#"+c._containerId+"viewer-settings-ok-button").click(function(){a._applySettings();a.hide()});$("#"+c._containerId+"viewer-settings-cancel-button").click(function(){a.hide()});$("#"+c._containerId+"viewer-settings-apply-button").click(function(){a._applySettings()});$("#"+c._containerId+"settings-pmi-enabled").click(function(){$("#"+c._containerId+"settings-pmi-enabled").prop("checked")?($("#"+c._containerId+"settings-pmi-color").prop("disabled",!1),
$("#"+c._containerId+"settings-pmi-color-style").removeClass("grayed-out")):($("#"+c._containerId+"settings-pmi-color").prop("disabled",!0),$("#"+c._containerId+"settings-pmi-color-style").addClass("grayed-out"))});$("#settings-enable-face-line-selection").click(function(){$("#settings-enable-face-line-selection").prop("checked")?($("#"+c._containerId+"settings-selection-color-face-line").prop("disabled",!1),$("#"+c._containerId+"settings-selection-color-face-line-style").removeClass("grayed-out")):
($("#"+c._containerId+"settings-selection-color-face-line").prop("disabled",!0),$("#"+c._containerId+"settings-selection-color-face-line-style").addClass("grayed-out"))});$("#"+a._containerId+"settings-splat-rendering-enabled").click(function(){$("#"+a._containerId+"settings-splat-rendering-enabled").prop("checked")?($("#"+a._containerId+"settings-splat-enabled-style").removeClass("grayed-out"),$("#"+a._containerId+"settings-splat-rendering-size").prop("disabled",!1),$("#"+a._containerId+"settings-splat-rendering-point-size-unit").prop("disabled",
!1)):($("#"+a._containerId+"settings-splat-enabled-style").addClass("grayed-out"),$("#"+a._containerId+"settings-splat-rendering-size").prop("disabled",!0),$("#"+a._containerId+"settings-splat-rendering-point-size-unit").prop("disabled",!0))})};a.prototype._readSettings=function(){var a=this,c=this._viewer.getView(),e=this._viewer.getModel(),g=this._viewer.getSelectionManager(),p=this._viewer.getCuttingManager(),l=this._viewer.getMeasureManager(),m=this._viewer.getOperatorManager();this._versionInfo&&
($("#"+a._containerId+"settings-format-version").html(" 1.0"),$("#"+a._containerId+"settings-viewer-version").html(" 1.0.0"),this._versionInfo=!1);var n=c.getBackgroundColor();this._backgroundColorTop=null===n.top?this._colorFromRgbString("rgb(192,220,248)"):n.top;this._backgroundColorBottom=null===n.bottom?this._colorFromRgbString("rgb(192,220,248)"):n.bottom;this._selectionColorBody=g.getNodeSelectionColor();this._selectionColorFaceLine=g.getNodeElementSelectionColor();this._measurementColor=l.getMeasurementColor();
this._projectionMode=c.getProjectionMode();this._showBackfaces=c.getBackfacesVisible();this._hiddenLineOpacity=c.getHiddenLineSettings().getObscuredLineTransparency();this._showCappingGeometry=p.getCappingGeometryVisibility();this._enableFaceLineSelection=g.getHighlightFaceElementSelection()&&g.getHighlightLineElementSelection();this._cappingGeometryFaceColor=p.getCappingFaceColor();this._cappingGeometryLineColor=p.getCappingLineColor();this._ambientOcclusionEnabled=c.getAmbientOcclusionEnabled();
this._ambientOcclusionRadius=c.getAmbientOcclusionRadius();this._antiAliasingEnabled=c.getAntiAliasingMode()==d.AntiAliasingMode.SMAA;this._PMIColor=e.getPMIColor();this._PMIEnabled=e.getPMIColorOverride();this._orbitCameraTarget=m.getOperator(d.OperatorId.Orbit).getOrbitFallbackMode()==d.OrbitFallbackMode.CameraTarget?!0:!1;this._axisTriadEnabled=this._axisTriad.getEnabled();this._navCubeEnabled=this._navCube.getEnabled();$("#"+a._containerId+"settings-selection-color-body").minicolors("value",this._rgbStringFromColor(this._selectionColorBody));
$("#"+a._containerId+"settings-selection-color-face-line").minicolors("value",this._rgbStringFromColor(this._selectionColorFaceLine));$("#"+a._containerId+"settings-background-top").minicolors("value",this._rgbStringFromColor(this._backgroundColorTop));$("#"+a._containerId+"settings-background-bottom").minicolors("value",this._rgbStringFromColor(this._backgroundColorBottom));$("#"+a._containerId+"settings-measurement-color").minicolors("value",this._rgbStringFromColor(this._measurementColor));$("#"+
a._containerId+"settings-capping-face-color").minicolors("value",this._rgbStringFromColor(this._cappingGeometryFaceColor));$("#"+a._containerId+"settings-capping-line-color").minicolors("value",this._rgbStringFromColor(this._cappingGeometryLineColor));$("#settings-projection-mode").val(this._projectionMode+"");$("#"+a._containerId+"settings-show-backfaces").prop("checked",this._showBackfaces);$("#settings-show-capping-geometry").prop("checked",this._showCappingGeometry);$("#"+a._containerId+"settings-enable-face-line-selection").prop("checked",
this._enableFaceLineSelection);$("#"+a._containerId+"settings-orbit-mode").prop("checked",this._orbitCameraTarget);$("#"+a._containerId+"settings-ambient-occlusion").prop("checked",this._ambientOcclusionEnabled);$("#"+a._containerId+"settings-ambient-occlusion-radius").val(this._ambientOcclusionRadius+"");$("#"+a._containerId+"settings-anti-aliasing").prop("checked",this._antiAliasingEnabled);$("#"+a._containerId+"settings-axis-triad").prop("checked",this._axisTriadEnabled);$("#"+a._containerId+"settings-nav-cube").prop("checked",
this._navCubeEnabled);$("#"+a._containerId+"settings-pmi-color").minicolors("value",this._rgbStringFromColor(this._PMIColor));this._PMIEnabled!=$("#"+a._containerId+"settings-pmi-enabled").prop("checked")&&$("#"+a._containerId+"settings-pmi-enabled").click();this._viewer.getMinimumFramerate().then(function(b){a._minFramerate=b;$("#settings-framerate").val(a._minFramerate+"")});null!=this._hiddenLineOpacity?$("#"+a._containerId+"settings-hidden-line-opacity").val(this._hiddenLineOpacity+""):$("#"+
a._containerId+"settings-hidden-line-opacity").val("");c.getPointSize().then(function(b){var c=b[0];b=b[1];a._splatRenderingEnabled=1!==c||b!==d.PointSizeUnit.ScreenPixels;a._splatRenderingEnabled!=$("#"+a._containerId+"settings-splat-rendering-enabled").prop("checked")&&$("#"+a._containerId+"settings-splat-rendering-enabled").click();a._splatRenderingEnabled&&(a._splatRenderingSize=c,a._splatRenderingPointSizeUnit=b);$("#"+a._containerId+"settings-splat-rendering-size").val(a._splatRenderingSize+
"");$("#"+a._containerId+"settings-splat-rendering-point-size-unit").val(a._splatRenderingPointSizeUnit+"")});c.getEyeDomeLightingEnabled().then(function(b){a._eyeDomeLightingEnabled=b;$("#"+a._containerId+"settings-eye-dome-lighting-enabled").prop("checked",a._eyeDomeLightingEnabled)})};a.prototype._applySettings=function(){var a=this._viewer.getView(),c=this._colorFromRgbString($("#"+this._containerId+"settings-background-top").val()),e=this._colorFromRgbString($("#"+this._containerId+"settings-background-bottom").val());
this._viewer.getView().setBackgroundColor(c,e);c=this._colorFromRgbString($("#"+this._containerId+"settings-selection-color-body").val());this._viewer.getSelectionManager().setNodeSelectionColor(c);this._viewer.getSelectionManager().setNodeSelectionOutlineColor(c);c=this._colorFromRgbString($("#"+this._containerId+"settings-selection-color-face-line").val());this._viewer.getSelectionManager().setNodeElementSelectionColor(c);this._viewer.getSelectionManager().setNodeElementSelectionOutlineColor(c);
c=$("#"+this._containerId+"settings-enable-face-line-selection").prop("checked");this._viewer.getSelectionManager().setHighlightFaceElementSelection(c);this._viewer.getSelectionManager().setHighlightLineElementSelection(c);this._viewer.getMeasureManager().setMeasurementColor(this._colorFromRgbString($("#"+this._containerId+"settings-measurement-color").val()));this._PMIColor=this._colorFromRgbString($("#"+this._containerId+"settings-pmi-color").val());this._PMIEnabled=$("#"+this._containerId+"settings-pmi-enabled").prop("checked");
this._PMIColor&&this._PMIEnabled?(this._viewer.getModel().setPMIColor(this._PMIColor),this._viewer.getModel().setPMIColorOverride(!0)):this._viewer.getModel().setPMIColorOverride(!1);this._viewer.getCuttingManager().setCappingFaceColor(this._colorFromRgbString($("#"+this._containerId+"settings-capping-face-color").val()));this._viewer.getCuttingManager().setCappingLineColor(this._colorFromRgbString($("#"+this._containerId+"settings-capping-line-color").val()));this._viewer.getView().setProjectionMode(parseInt($("#settings-projection-mode").val()));
c=$("#"+this._containerId+"settings-show-backfaces").prop("checked");this._viewer.getView().setBackfacesVisible(c);c=$("#settings-show-capping-geometry").prop("checked");this._viewer.getCuttingManager().setCappingGeometryVisibility(c);(c=parseInt($("#settings-framerate").val()))&&0<c&&(this._minFramerate=c,this._viewer.setMinimumFramerate(this._minFramerate));c=parseFloat($("#"+this._containerId+"settings-hidden-line-opacity").val());this._viewer.getView().getHiddenLineSettings().setObscuredLineTransparency(c);
this._viewer.getView().getDrawMode()==d.DrawMode.HiddenLine&&this._viewer.getView().setDrawMode(d.DrawMode.HiddenLine);c=this._viewer.getOperatorManager().getOperator(d.OperatorId.Orbit);e=$("#"+this._containerId+"settings-orbit-mode").prop("checked");c.setOrbitFallbackMode(e?d.OrbitFallbackMode.CameraTarget:d.OrbitFallbackMode.ModelCenter);this._viewer.getView().setAmbientOcclusionEnabled($("#"+this._containerId+"settings-ambient-occlusion").prop("checked"));this._viewer.getView().setAmbientOcclusionRadius(parseFloat($("#"+
this._containerId+"settings-ambient-occlusion-radius").val()));$("#"+this._containerId+"settings-anti-aliasing").prop("checked")?this._viewer.getView().setAntiAliasingMode(d.AntiAliasingMode.SMAA):this._viewer.getView().setAntiAliasingMode(d.AntiAliasingMode.None);$("#"+this._containerId+"settings-axis-triad").prop("checked")?this._axisTriad.enable():this._axisTriad.disable();$("#"+this._containerId+"settings-nav-cube").prop("checked")?this._navCube.enable():this._navCube.disable();$("#"+this._containerId+
"settings-splat-rendering-enabled").prop("checked")?(this._splatRenderingEnabled=!0,this._splatRenderingSize=parseFloat($("#"+this._containerId+"settings-splat-rendering-size").val()),this._splatRenderingPointSizeUnit=parseInt($("#"+this._containerId+"settings-splat-rendering-point-size-unit").val()),a.setPointSize(this._splatRenderingSize,this._splatRenderingPointSizeUnit)):(this._splatRenderingEnabled=!1,a.setPointSize(1,d.PointSizeUnit.ScreenPixels));a.setEyeDomeLightingEnabled($("#"+this._containerId+
"settings-eye-dome-lighting-enabled").prop("checked"))};a.prototype._colorFromRgbString=function(a){a=a.replace(/[^\d,]/g,"").split(",");return new d.Color(a[0],a[1],a[2])};a.prototype._rgbStringFromColor=function(a){return null==a?"":"rgb("+a.r+","+a.g+","+a.b+")"};return a}();e.ViewerSettings=c})(e.Desktop||(e.Desktop={}))})(d.Ui||(d.Ui={}))})(Communicator||(Communicator={}));
(function(d){(function(e){(function(g){var c=function(){function a(a,c,e){this.containerId=e;void 0===c&&(c=d.ScreenConfiguration.Desktop);this._viewer=a;this._screenConfiguration=c;this._initElements();this._initEvents()}a.prototype._initElements=function(){this._cuttingPlaneController=new d.Ui.CuttingPlaneController(this._viewer);this._axisTriad=this._viewer.getView().getAxisTriad();this._navCube=this._viewer.getView().getNavCube();this._screenConfiguration==d.ScreenConfiguration.Mobile&&(this._axisTriad.setAnchor(d.OverlayAnchor.UpperRightCorner),
this._navCube.setAnchor(d.OverlayAnchor.UpperLeftCorner));this._toolbar=new e.Toolbar(this._viewer,this._cuttingPlaneController,this._axisTriad,this._navCube,this._screenConfiguration,this.containerId);this._toolbar.init();var a=this._viewer.getOperatorManager().getOperator(d.OperatorId.Handle);a&&a.setHandleSize(this._screenConfiguration==d.ScreenConfiguration.Mobile?3:1);a=document.getElementById(this.containerId);a.oncontextmenu=function(){return!1};this._isolateZoomHelper=new d.IsolateZoomHelper(this._viewer);
var c=document.createElement("div");c.id=this.containerId+"streamingIndicator";a.appendChild(c);this._viewer.getRendererType()==d.RendererType.Client&&(this._streamingIndicator=new e.StreamingIndicator(c.id,this._viewer));this._contextMenu=new e.RightClickContextMenu(this.containerId,this._viewer,this._isolateZoomHelper);this._timeoutWarningDialog=new e.TimeoutWarningDialog(this.containerId,this._viewer)};a.prototype._initEvents=function(){var a=this;if(!this.webgl_detect()){var c=new d.Ui.UiDialog(this.containerId);
c.setTitle("WebGL\u672a\u68c0\u6d4b\u5230");c.setText("WebGL\u672a\u68c0\u6d4b\u5230\uff0c\u8bf7\u4f7f\u7528\u4e91\u6e32\u67d3\u6a21\u5f0f");c.show()}this._viewer.setCallbacks({sceneReady:function(){a._onSceneReady()},modelStructureHeaderParsed:function(){a._updateDrawingsUI()},modelLoadFailure:function(a,b){var c=new d.Ui.UiDialog(this.containerId);c.setTitle("\u6a21\u578b\u52a0\u8f7d\u9519\u8bef");var e="\u4e0d\u80fd\u52a0\u8f7d ";c.setText((null===a?e+"model":e+("'"+a+"'"))+(".\u672a\u52a0\u8f7d\u6210\u529f\u7684\u539f\u56e0: "+
b));c.show()},volumeSelectionLoadBegin:function(){},volumeSelectionLoadEnd:function(){},volumeSelectionEnd:function(){},XHRonloadend:function(a,b,c){404===b&&(a=new d.Ui.UiDialog(this.containerId),a.setTitle("404 Error"),a.setText("\u4e0d\u80fd\u52a0\u8f7d\u6a21\u578b\uff1a "+c),a.show())},modelSwitched:function(){a._updateDrawingsUI()}})};a.prototype._updateDrawingsUI=function(){this._viewer.getModel().isDrawing()?($("#"+this.containerId+"cuttingplane-button").hide(),$("#"+this.containerId+"explode-button").hide(),
$("#"+this.containerId+"view-button").hide(),$("#"+this.containerId+"camera-button").hide(),$("#tool_separator_4").hide(),$("#tool_separator_1").hide(),$("#"+this.containerId+"edgeface-button").hide(),this._toolbar.reposition(),$(".ui-modeltree").addClass("drawing")):($("#"+this.containerId+"cuttingplane-button").show(),$("#"+this.containerId+"explode-button").show(),$("#"+this.containerId+"view-button").show(),$("#"+this.containerId+"camera-button").show(),$("#tool_separator_4").show(),$("#tool_separator_1").show(),
$("#"+this.containerId+"edgeface-button").show(),this._toolbar.reposition(),$(".ui-modeltree").removeClass("drawing"),this._viewer.enableBackgroundSheet(!1));this._axisTriad.disable();this._navCube.disable()};a.prototype._onSceneReady=function(){var b=this;this._viewer.focusInput(!0);this._viewer.getSelectionManager().setNodeSelectionColor(a._defaultPartSelectionColor);this._viewer.getSelectionManager().setNodeSelectionOutlineColor(a._defaultPartSelectionOutlineColor);var c=this._viewer.getView();
c.setXRayColor(d.ElementType.Faces,a._defaultXRayColor);c.setXRayColor(d.ElementType.Lines,a._defaultXRayColor);c.setXRayColor(d.ElementType.Points,a._defaultXRayColor);c.setBackgroundColor(a._defaultBackgroundColor,a._defaultBackgroundColor);this._viewer.getViewElement().addEventListener("mouseenter",function(){b._viewer.focusInput(!0)})};a.prototype.setDeselectOnIsolate=function(a){this._isolateZoomHelper.setDeselectOnIsolate(a)};a.prototype.webgl_detect=function(){if(window.WebGLRenderingContext){var a=
document.createElement("canvas"),c=["webgl","experimental-webgl","moz-webgl"],d=!1,e;for(e in c)try{if((d=a.getContext(c[e]))&&"function"==typeof d.getParameter)return!0}catch(p){}}return!1};a._defaultBackgroundColor=d.Color.white();a._defaultPartSelectionColor=d.Color.createFromFloat(0,.8,0);a._defaultPartSelectionOutlineColor=d.Color.createFromFloat(0,.8,0);a._defaultXRayColor=d.Color.createFromFloat(0,.9,0);return a}();g.DesktopUi=c})(e.Desktop||(e.Desktop={}))})(d.Ui||(d.Ui={}))})(Communicator||
(Communicator={}));